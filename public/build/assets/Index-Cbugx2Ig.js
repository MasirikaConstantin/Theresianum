import{j as e,r as y,t as _,H as k,b as m,L}from"./app-BiR3H72c.js";import{B as l}from"./button-DfBT4842.js";import{T as M,a as E,b as D,c as h,f as I,d as z,e as u}from"./table-CMAMKCJS.js";import{S as B,a as J,b as R,c as V,d as f}from"./select-B5KxOem9.js";import{B as x}from"./badge-NokOUrZG.js";import{C as q}from"./calendar-Bm37FrpH.js";import{P as C,a as g,b as w}from"./popover-B0R-MFpt.js";import{e as A,f as b,g as G,A as O}from"./app-layout-DXRwYbWn.js";import{P as U}from"./Pagination-C-awdoMT.js";import{L as T}from"./label-C35PAQno.js";import{A as S,a as W}from"./alert-CJytHgmU.js";import{D as K,a as Q,b as X,c as Y,d as Z,e as ee,f as se,g as re}from"./dialog-C2xpyM_9.js";import{E as ae}from"./eye-xwMsSdsH.js";import{f as i}from"./format-B6qNwQQI.js";import{f as v}from"./fr-CLbTb0XB.js";import{c as te}from"./utils-D-KgF5mV.js";import{C as le,a as ie,b as ne,c as de,d as ce,e as oe}from"./command-DS8EqxGi.js";import{C as me}from"./chevrons-up-down-D26-hiHV.js";import{C as he}from"./check-DVZ7LPyx.js";import{C as ue}from"./calendar-CQ4TJ2Ye.js";import{T as xe}from"./trash-2-DAGSehnZ.js";import{P as je}from"./pencil-BBfKa5zT.js";import"./app-BojVexQw.js";import"./index-BdQq_4o_.js";import"./index-C4BIJOdj.js";import"./index-CHBa3DK4.js";import"./index-DZfrvXPy.js";import"./chevron-down-C8aG4wQu.js";import"./index-CaoPq-lK.js";import"./index-D85psPK1.js";import"./index-DL4BAlbN.js";import"./createLucideIcon-AVJzoGs5.js";import"./index-Di7OUUGl.js";import"./index-D-SBhKFM.js";import"./DayPicker-BNzRSgUN.js";import"./chevron-left-CImlN05b.js";import"./chevron-right-F_DONt-v.js";import"./breadcrumbs-CfH9HSk2.js";import"./index-DZGh8cYj.js";import"./app-logo-icon-D1TxLKab.js";import"./package-CMie0C_N.js";import"./circle-alert-CxFuhzFA.js";import"./pagination-3fOkAI-N.js";import"./index-DufLrpEQ.js";import"./search-D5WKme3c.js";function pe({pointage:s}){return e.jsx(K,{children:e.jsxs("form",{children:[e.jsx(Q,{asChild:!0,children:e.jsx(l,{variant:"outline",size:"sm",children:e.jsx(ae,{className:"h-4 w-4"})})}),e.jsxs(X,{className:"sm:max-w-[625px]",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Detail du pointage"}),e.jsx(ee,{children:"Détails du pointage"})]}),e.jsx("div",{className:"flex items-center justify-center",children:s.agent.avatar_url?e.jsxs(A,{children:[e.jsx(b,{className:"w-48 h-48 rounded-full",src:s.agent.avatar_url}),e.jsx(G,{className:"w-48 h-48 rounded-full bg-accent",children:s.agent.nom.charAt(0)+s.agent.postnom.charAt(0)+s.agent.prenom.charAt(0)})]}):e.jsx(A,{className:"w-48 h-48 bg-accent rounded-full",children:s.agent.sexe==="Masculin"?e.jsx(b,{className:"w-48 h-48 rounded-full",src:"images/icons/male.png"}):e.jsx(b,{className:"w-48 h-48 rounded-full",src:"images/icons/female.png"})})}),e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("p",{children:[" Agent : ",e.jsxs("span",{className:"font-semibold",children:[s.agent.nom," ",s.agent.postnom," ",s.agent.prenom]})]}),e.jsxs("p",{children:["Date : ",e.jsx("span",{className:"font-semibold",children:i(s.date,"PPP",{locale:v})})]}),e.jsxs("p",{children:["Statut : ",e.jsx("span",{className:"font-semibold",children:s.statut==="present"?"Présent":s.statut==="absent"?"Absent":s.statut==="conge"?"Congé":s.statut==="malade"?"Malade":s.statut==="formation"?"Formation":s.statut==="mission"?"Mission":s.statut})]}),e.jsxs("p",{children:["Justification : ",e.jsx("span",{className:"font-semibold",children:s.justification})]}),e.jsxs("p",{children:["Notes : ",e.jsx("span",{className:"font-semibold",children:s.notes})]}),e.jsxs("p",{children:["Justifié : ",e.jsx("span",{className:"font-semibold",children:s.justifie?"Oui":"Non"})]}),e.jsxs("ul",{children:[s.heure_arrivee&&e.jsxs("li",{children:["Heure d'arrivée : ",e.jsxs(x,{variant:(s==null?void 0:s.statut_arrivee)==="a-lheure"?"default":"destructive",children:["   ",s==null?void 0:s.heure_arrivee," "]})," ",e.jsx("span",{className:"ml-2 font-semibold",children:(s==null?void 0:s.statut_arrivee)==="en-retard"?"En retard":"Arrivée à l'heure"})]}),s.heure_depart&&e.jsxs("li",{children:["Heure de départ : ",e.jsxs(x,{variant:(s==null?void 0:s.statut_depart)==="a-lheure"?"default":"destructive",children:["   ",s==null?void 0:s.heure_depart," "]})," ",e.jsx("span",{className:"ml-2 font-semibold",children:(s==null?void 0:s.statut_depart)==="parti-tot"?"Parti-tot":"Départ à l'heure"})]})]})]}),e.jsx(se,{children:e.jsx(re,{asChild:!0,children:e.jsx(l,{variant:"outline",children:"Fermer"})})})]})]})})}function fe({agents:s,value:d,onChange:t}){const[j,n]=y.useState(!1),[c,o]=y.useState(""),N=s.filter(a=>`${a.nom} ${a.postnom} ${a.prenom}`.toLowerCase().includes(c.toLowerCase())).map(a=>({value:a.id.toString(),label:`${a.nom} ${a.postnom} ${a.prenom}`,fullText:`${a.matricule?a.matricule+" - ":""}${a.nom} ${a.postnom} ${a.prenom}`.toLowerCase()})),r=s.find(a=>a.id.toString()===d);return e.jsxs(C,{open:j,onOpenChange:n,children:[e.jsx(g,{asChild:!0,children:e.jsxs(l,{variant:"outline",role:"combobox","aria-expanded":j,className:"w-full justify-between",children:[r?`${r.nom} ${r.postnom} ${r.prenom}`:"Rechercher un agent...",e.jsx(me,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(w,{className:"w-[350px] p-0",children:e.jsxs(le,{shouldFilter:!1,children:[e.jsx(ie,{placeholder:"Rechercher par nom...",value:c,onValueChange:o}),e.jsxs(ne,{children:[e.jsx(de,{children:"Aucun agent trouvé"}),e.jsx(ce,{children:N.map(a=>e.jsxs(oe,{value:a.fullText,onSelect:()=>{t(a.value===d?"":a.value),n(!1),o("")},children:[a.label,e.jsx(he,{className:te("ml-auto h-4 w-4",d===a.value?"opacity-100":"opacity-0")})]},a.value))})]})]})})]})}function cs({auth:s,pointages:d,filters:t,agents:j,flash:n}){const c=(r,a)=>{m.get(route("pointages.index"),{...t,[r]:a},{preserveState:!0,replace:!0})};n.success?_.success(n.success):n.error&&_.error(n.error);const o=(r,a,p,H,$,F)=>{r.preventDefault(),m.post(route("pointages.generate-time"),{agent_id:a,date:p,heure_arrivee:H,heure_depart:$,pointage_id:F})},P=()=>{m.visit(route("pointages.print"),{data:{agent_id:t.agent_id,date:t.date,statut:t.statut}})},N=r=>{const a=i(new Date,"yyyy-MM-dd"),p=i(new Date(r),"yyyy-MM-dd");return a===p};return e.jsxs(O,{auth:s,breadcrumbs:[{title:"Pointages",href:route("pointages.index")}],children:[e.jsx(k,{title:"Pointages"}),e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"font-semibold text-2xl  leading-tight",children:"Gestion des pointages"}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(l,{variant:"outline",onClick:()=>m.post(route("pointages.generate-daily")),children:"Générer pointages du jour"}),e.jsx(l,{onClick:P,children:"Imprimer le rapport"})]})]}),e.jsx("div",{className:"max-w-7xl mx-auto sm:px-6 lg:px-8",children:e.jsxs("div",{className:"overflow-hidden shadow-sm sm:rounded-lg p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-2 mb-6",children:[e.jsx(fe,{agents:j,value:t.agent_id||"",onChange:r=>c("agent_id",r)}),e.jsxs(C,{children:[e.jsx(g,{asChild:!0,children:e.jsxs(l,{variant:"outline",className:"justify-start text-left font-normal ml-6",children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),t.date?i(new Date(t.date),"PPP",{locale:v}):"Filtrer par date"]})}),e.jsx(w,{className:"w-auto p-0",children:e.jsx(q,{mode:"single",selected:t.date?new Date(t.date):void 0,onSelect:r=>c("date",r?i(r,"yyyy-MM-dd"):void 0),initialFocus:!0,locale:v})})]}),e.jsxs(B,{value:t.statut||"",onValueChange:r=>c("statut",r||void 0),children:[e.jsx(J,{children:e.jsx(R,{placeholder:"Filtrer par statut"})}),e.jsxs(V,{children:[e.jsx(f,{value:"present",children:"Présent"}),e.jsx(f,{value:"absent",children:"Absent"}),e.jsx(f,{value:"congé",children:"En congé"}),e.jsx(f,{value:"malade",children:"Malade"})]})]}),e.jsxs(l,{variant:"outline",onClick:()=>{m.get(route("pointages.index"),{},{preserveState:!1})},children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Vider les filtres"]})]}),e.jsx(S,{className:"bg-amber-100 mb-3",children:e.jsx(W,{children:"Les pointages automatique se font pour les agents actif et ayant un contrat actif"})}),e.jsxs(M,{children:[e.jsx(E,{children:e.jsxs(D,{children:[e.jsx(h,{children:"Agent"}),e.jsx(h,{children:"Date"}),e.jsx(h,{children:"Heure arrivée"}),e.jsx(h,{children:"Heure départ"}),e.jsx(h,{children:"Actions"})]})}),e.jsx(I,{children:"Les pointages"}),e.jsx(z,{children:d.data.map(r=>e.jsxs(D,{children:[e.jsxs(u,{children:[r.agent.nom," ",r.agent.postnom," ",r.agent.nom]}),e.jsx(u,{children:i(new Date(r.date),"PPP",{locale:v})}),e.jsx(u,{children:r.heure_arrivee||"-"}),e.jsx(u,{children:r.heure_depart||"-"}),e.jsx(u,{className:"space-x-2 flex",children:r.statut==="congé"?e.jsx(x,{variant:"secondary",className:"bg-green-500 p-1",children:"En congé"}):e.jsxs(e.Fragment,{children:[e.jsx(L,{href:route("pointages.edit",r.id),children:e.jsx(l,{variant:"outline",size:"sm",children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsx("div",{className:"flex",children:e.jsx(pe,{pointage:r})}),N(r.date)?e.jsxs(C,{children:[e.jsx(g,{asChild:!0,children:e.jsx(l,{variant:"outline",children:"Pointage"})}),e.jsx(w,{className:"w-96",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"leading-none font-medium",children:"Pointage"}),e.jsx(S,{className:"flex items-center gap-2 bg-emerald-400",children:e.jsx("p",{className:"text-sm text-black",children:"Pointez lorsque l'agent se pointe. l'heure d'arrivée et de départ seront automatiquement enregistrées."})})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"grid grid-cols-2 items-center ",children:[e.jsx(T,{htmlFor:"width",children:"Heure d'arrivée"}),r.heure_arrivee?e.jsxs(x,{variant:"outline",className:"bg-green-500",children:["Pointé à  ",r.heure_arrivee," : ",r.statut_arrivee==="en-retard"?"en retard":"à l'heure"]}):e.jsx(l,{variant:"default",size:"sm",onClick:a=>o(a,r.agent_id,r.date,i(new Date,"HH:mm:ss"),"",r.id),children:"Pointer"})]}),r.heure_arrivee?e.jsxs("div",{className:"grid grid-cols-2 items-center",children:[e.jsx(T,{htmlFor:"maxWidth",children:"Heure de départ"}),r.heure_depart?e.jsxs(x,{variant:"outline",className:"bg-green-500",children:["Pointé à  ",r.heure_depart," : ",r.statut_depart==="parti-tot"?"parti tot":"à l'heure"]}):e.jsx(l,{variant:"default",size:"sm",onClick:a=>o(a,r.agent_id,r.date,"",i(new Date,"HH:mm:ss"),r.id),children:"Pointer"})]}):e.jsx("p",{className:"text-sm text-gray-500",children:"Pointé l'heure d'arrivée avant de pointer l'heure de départ"})]})]})})]}):e.jsx("p",{className:"text-sm text-gray-500",children:"Jour passé"})]})})]},r.id))})]}),e.jsx("div",{className:"mt-4 flex justify-center items-center",children:e.jsx(U,{data:d})})]})})]})]})}export{cs as default};
