import{u as ne,r as D,d as ie,t as x,j as e,L as le}from"./app-BiR3H72c.js";import{B as g}from"./button-DfBT4842.js";import{I as i}from"./input-CBAXjYrY.js";import{L as n}from"./label-C35PAQno.js";import{S as oe,a as ce,b as de,c as me,d as ue}from"./select-B5KxOem9.js";import{C as v,a as f,b as y,d as b}from"./card-CtX8457h.js";import{C as M}from"./calendar-Bm37FrpH.js";import{P as w,a as A,b as $}from"./popover-B0R-MFpt.js";import{c as E}from"./utils-D-KgF5mV.js";import{A as L,b as H,a as O}from"./alert-CJytHgmU.js";import{B as V}from"./badge-NokOUrZG.js";import{f as N}from"./formatMoney-CtkS2hMP.js";import _e from"./AgentsList-CW60a8sb.js";import{C as P}from"./calendar-CQ4TJ2Ye.js";import{f as c}from"./format-B6qNwQQI.js";import{f as j}from"./fr-CLbTb0XB.js";import"./app-BojVexQw.js";import"./index-DufLrpEQ.js";import"./index-CaoPq-lK.js";import"./index-BdQq_4o_.js";import"./index-C4BIJOdj.js";import"./index-CHBa3DK4.js";import"./index-DZfrvXPy.js";import"./chevron-down-C8aG4wQu.js";import"./index-D85psPK1.js";import"./index-DL4BAlbN.js";import"./createLucideIcon-AVJzoGs5.js";import"./index-Di7OUUGl.js";import"./index-D-SBhKFM.js";import"./check-DVZ7LPyx.js";import"./DayPicker-BNzRSgUN.js";import"./chevron-left-CImlN05b.js";import"./chevron-right-F_DONt-v.js";function Qe({defaultPeriod:m,paie:r,flash:_}){var B,I;const{data:s,setData:p,post:q,put:k,processing:R,errors:d}=ne({agent_id:(r==null?void 0:r.agent_id)||"",date_debut_periode:r!=null&&r.date_debut_periode?c(new Date(r.date_debut_periode),"yyyy-MM-dd"):c(new Date((m==null?void 0:m.start)||""),"yyyy-MM-dd")||"",date_fin_periode:r!=null&&r.date_fin_periode?c(new Date(r.date_fin_periode),"yyyy-MM-dd"):c(new Date((m==null?void 0:m.end)||""),"yyyy-MM-dd")||"",date_emission:r!=null&&r.date_emission?c(new Date(r.date_emission),"yyyy-MM-dd"):c(new Date((m==null?void 0:m.emission)||""),"yyyy-MM-dd")||"",salaire_base:(r==null?void 0:r.salaire_base)||0,heures_supplementaires:(r==null?void 0:r.heures_supplementaires)||0,conges_payes:(r==null?void 0:r.conges_payes)||0,pecule_conge:(r==null?void 0:r.pecule_conge)||0,gratification:(r==null?void 0:r.gratification)||0,prime_fidelite:(r==null?void 0:r.prime_fidelite)||0,prime_diverse:(r==null?void 0:r.prime_diverse)||0,allocation_familiale:(r==null?void 0:r.allocation_familiale)||0,allocation_epouse:(r==null?void 0:r.allocation_epouse)||0,afm_gratification:(r==null?void 0:r.afm_gratification)||0,cotisation_cnss:(r==null?void 0:r.cotisation_cnss)||0,impot_revenu:(r==null?void 0:r.impot_revenu)||0,prets_retenus:(r==null?void 0:r.prets_retenus)||0,avance_salaire:(r==null?void 0:r.avance_salaire)||0,paie_negative:(r==null?void 0:r.paie_negative)||0,autres_regularisations:(r==null?void 0:r.autres_regularisations)||0,net_a_payer:(r==null?void 0:r.net_a_payer)||0}),[F,z]=D.useState([]),h=(()=>{const a=Number(s.salaire_base)||0,o=Number(s.heures_supplementaires)||0,u=Number(s.conges_payes)||0,C=Number(s.pecule_conge)||0,S=Number(s.gratification)||0,K=Number(s.prime_fidelite)||0,Q=Number(s.prime_diverse)||0,U=Number(s.allocation_familiale)||0,W=Number(s.allocation_epouse)||0,X=Number(s.afm_gratification)||0,Y=Number(s.cotisation_cnss)||0,Z=Number(s.impot_revenu)||0,ee=Number(s.prets_retenus)||0,se=Number(s.avance_salaire)||0,re=Number(s.paie_negative)||0,ae=Number(s.autres_regularisations)||0,T=a+o+u+C+S+K+Q+U+W+X,G=Y+Z+ee+se+re+ae,te=T-G;return{remunerationBrute:T,totalRetenues:G,netAPayer:te}})();D.useEffect(()=>{p("net_a_payer",h.netAPayer)},[s.salaire_base,s.heures_supplementaires,s.conges_payes,s.pecule_conge,s.gratification,s.prime_fidelite,s.prime_diverse,s.allocation_familiale,s.allocation_epouse,s.afm_gratification,s.cotisation_cnss,s.impot_revenu,s.prets_retenus,s.avance_salaire,s.paie_negative,s.autres_regularisations]),D.useEffect(()=>{ie.get(route("get-agent"),{params:{date:s.date_debut_periode,date_fin_periode:s.date_fin_periode}}).then(a=>{z(a.data)}).catch(a=>{console.error("Error fetching agents:",a)})},[s.date_debut_periode,s.date_fin_periode]),_!=null&&_.success&&x.success(_.success),_!=null&&_.error&&x.error(_.error);const t=F.find(a=>a.id===Number(s.agent_id)),J=a=>{a.preventDefault();const o={...s,salaire_base:Number(s.salaire_base)||0,heures_supplementaires:Number(s.heures_supplementaires)||0,conges_payes:Number(s.conges_payes)||0,pecule_conge:Number(s.pecule_conge)||0,gratification:Number(s.gratification)||0,prime_fidelite:Number(s.prime_fidelite)||0,prime_diverse:Number(s.prime_diverse)||0,allocation_familiale:Number(s.allocation_familiale)||0,allocation_epouse:Number(s.allocation_epouse)||0,afm_gratification:Number(s.afm_gratification)||0,cotisation_cnss:Number(s.cotisation_cnss)||0,impot_revenu:Number(s.impot_revenu)||0,prets_retenus:Number(s.prets_retenus)||0,avance_salaire:Number(s.avance_salaire)||0,paie_negative:Number(s.paie_negative)||0,autres_regularisations:Number(s.autres_regularisations)||0,net_a_payer:h.netAPayer};r!=null&&r.id?k(route("paies.update",r.id),{data:o,onSuccess:()=>{x.success("Bulletin de paie mis à jour avec succès.")},onError:u=>{x.error("Erreur lors de la mise à jour."),console.error("Erreurs:",u)}}):q(route("paies.store"),{data:o,onSuccess:()=>{x.success("Bulletin de paie créé avec succès.")},onError:u=>{x.error("Erreur lors de la création."),console.error("Erreurs:",u)}})};console.log(s);const l=(a,o)=>{p(a,o)};return e.jsxs("form",{onSubmit:J,className:"space-y-6",children:[e.jsxs(v,{children:[e.jsx(f,{children:e.jsx(y,{children:"Informations de base"})}),e.jsxs(b,{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"agent_id",children:"Agent "}),e.jsxs(oe,{value:String(s.agent_id),onValueChange:a=>{var C;const o=Number(a),u=F.find(S=>S.id===o);p({...s,agent_id:o,salaire_base:Number((C=u==null?void 0:u.contrats[0])==null?void 0:C.salaire_base)||0})},children:[e.jsx(ce,{children:e.jsx(de,{placeholder:"Sélectionner un agent"})}),e.jsx(me,{children:F.map(a=>e.jsxs(ue,{value:String(a.id),children:[a.matricule," - ",a.nom," ",a.postnom]},a.id))})]}),d.agent_id&&e.jsx("p",{className:"text-sm text-red-500",children:d.agent_id})]}),t&&e.jsxs("div",{className:"space-y-2 ml-6",children:[e.jsx(n,{children:"Informations Agent"}),e.jsxs("div",{className:"text-sm p-2 border rounded",children:[e.jsxs("p",{children:["Matricule: ",e.jsx("span",{className:"font-bold",children:t.matricule||"Non renseigné"})]}),e.jsxs("p",{children:["CNSS: ",e.jsx("span",{className:"font-bold",children:t.numero_cnss||"Non renseigné"})]}),e.jsxs("p",{children:["Enfants: ",e.jsx("span",{className:"font-bold",children:t.nombre_enfant||0})]}),e.jsxs("p",{children:["Fonction: ",e.jsx("span",{className:"font-bold",children:t.role==="admin"?"Administrateur":t.role==="ressource_humaine"?"Ressource Humaine":t.role==="communicateur"?"Communicateur":t.role==="caissière"?"Caissière":t.role==="manager"?"Gestionnaire":t.role==="agent"?"Agent":t.role==="assistant_direction"?"Assistant Direction":t.role==="charge_vente_client"?"Charge vente client":t.role==="coiffeuse"?"Coiffeuse":t.role==="maquilleuse"?"Maquilleuse":t.role==="cleaner"?"Cleaner":t.role==="estheticienne"?"Esthéticienne":t.role==="prothesiste"?"Prothésiste":"Autre"})]})]}),e.jsx(_e,{agent:t})]})]})]}),e.jsxs(v,{children:[e.jsx(f,{children:e.jsx(y,{children:"Période de paie"})}),e.jsxs(b,{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Date début période"}),e.jsxs(w,{children:[e.jsx(A,{asChild:!0,children:e.jsxs(g,{variant:"outline",className:E("w-full justify-start text-left font-normal",!s.date_debut_periode&&"text-muted-foreground"),children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),s.date_debut_periode?c(new Date(s.date_debut_periode),"PPP",{locale:j}):e.jsx("span",{children:"Choisir une date"})]})}),e.jsx($,{className:"w-auto p-0",children:e.jsx(M,{mode:"single",locale:j,selected:s.date_debut_periode?new Date(s.date_debut_periode):void 0,onSelect:a=>{p("date_debut_periode",a?c(a,"yyyy-MM-dd"):"")},initialFocus:!0})})]}),d.date_debut_periode&&e.jsx("p",{className:"text-sm text-red-500",children:d.date_debut_periode})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Date fin période"}),e.jsxs(w,{children:[e.jsx(A,{asChild:!0,children:e.jsxs(g,{variant:"outline",className:E("w-full justify-start text-left font-normal",!s.date_fin_periode&&"text-muted-foreground"),children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),s.date_fin_periode?c(new Date(s.date_fin_periode),"PPP",{locale:j}):e.jsx("span",{children:"Choisir une date"})]})}),e.jsx($,{className:"w-auto p-0",children:e.jsx(M,{mode:"single",locale:j,selected:s.date_fin_periode?new Date(s.date_fin_periode):void 0,onSelect:a=>{if(a){const o=new Date(a);o.setDate(o.getDate()+1),o.setMilliseconds(-1),p("date_fin_periode",c(o,"yyyy-MM-dd"))}else p("date_fin_periode","")},initialFocus:!0})})]}),d.date_fin_periode&&e.jsx("p",{className:"text-sm text-red-500",children:d.date_fin_periode})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Date d'émission"}),e.jsxs(w,{children:[e.jsx(A,{asChild:!0,children:e.jsxs(g,{variant:"outline",className:E("w-full justify-start text-left font-normal",!s.date_emission&&"text-muted-foreground"),children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),s.date_emission?c(new Date(s.date_emission),"PPP",{locale:j}):e.jsx("span",{children:"Choisir une date"})]})}),e.jsx($,{className:"w-auto p-0",children:e.jsx(M,{mode:"single",locale:j,selected:s.date_emission?new Date(s.date_emission):void 0,onSelect:a=>p("date_emission",a?c(a,"yyyy-MM-dd"):""),initialFocus:!0})})]}),d.date_emission&&e.jsx("p",{className:"text-sm text-red-500",children:d.date_emission})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(v,{children:[e.jsx(f,{children:e.jsxs(y,{className:"text-green-600",children:["Gains (",N(h.remunerationBrute),")"]})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"salaire_base",children:"Salaire de base ($)"}),e.jsx(i,{id:"salaire_base",type:"number",step:"0.01",value:s.salaire_base,onChange:a=>l("salaire_base",parseFloat(a.target.value)||0)}),d.salaire_base&&e.jsx("p",{className:"text-sm text-red-500",children:d.salaire_base}),t&&e.jsx(e.Fragment,{children:t!=null&&t.contrats[0]?e.jsxs(L,{children:[e.jsx(H,{children:"Attention"}),e.jsxs(O,{children:["Le salaire de base est le salaire inscrit dans le contrat.",e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(V,{variant:"outline",children:"Salaire de base"}),e.jsxs(V,{variant:"outline",children:[(B=t==null?void 0:t.contrats[0])==null?void 0:B.salaire_base,"$"]}),e.jsx(le,{href:`/contrats/${(I=t==null?void 0:t.contrats[0])==null?void 0:I.ref}`,children:e.jsx(g,{variant:"outline",size:"sm",children:"Voir contrat"})})]})]})]}):e.jsxs(L,{children:[e.jsx(H,{children:"Attention"}),e.jsx(O,{children:"Aucun contrat actif trouvé pour cet agent."})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"heures_supplementaires",children:"Heures supplémentaires ($)"}),e.jsx(i,{id:"heures_supplementaires",type:"number",step:"0.01",value:s.heures_supplementaires,onChange:a=>l("heures_supplementaires",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"conges_payes",children:"Congés payés ($)"}),e.jsx(i,{id:"conges_payes",type:"number",step:"0.01",value:s.conges_payes,onChange:a=>l("conges_payes",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"pecule_conge",children:"Pécule de congé ($)"}),e.jsx(i,{id:"pecule_conge",type:"number",step:"0.01",value:s.pecule_conge,onChange:a=>l("pecule_conge",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"gratification",children:"Gratification ($)"}),e.jsx(i,{id:"gratification",type:"number",step:"0.01",value:s.gratification,onChange:a=>l("gratification",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"prime_fidelite",children:"Prime de fidélité ($)"}),e.jsx(i,{id:"prime_fidelite",type:"number",step:"0.01",value:s.prime_fidelite,onChange:a=>l("prime_fidelite",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"prime_diverse",children:"Prime diverse ($)"}),e.jsx(i,{id:"prime_diverse",type:"number",step:"0.01",value:s.prime_diverse,onChange:a=>l("prime_diverse",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"allocation_familiale",children:"Allocation familiale ($)"}),e.jsx(i,{id:"allocation_familiale",type:"number",step:"0.01",value:s.allocation_familiale,onChange:a=>l("allocation_familiale",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"allocation_epouse",children:"Allocation épouse ($)"}),e.jsx(i,{id:"allocation_epouse",type:"number",step:"0.01",value:s.allocation_epouse,onChange:a=>l("allocation_epouse",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"afm_gratification",children:"AFM Gratification ($)"}),e.jsx(i,{id:"afm_gratification",type:"number",step:"0.01",value:s.afm_gratification,onChange:a=>l("afm_gratification",parseFloat(a.target.value)||0)})]})]})]}),e.jsxs(v,{children:[e.jsx(f,{children:e.jsxs(y,{className:"text-red-600",children:["Retenues (",N(h.totalRetenues),")"]})}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"cotisation_cnss",children:"Cotisation CNSS ($)"}),e.jsx(i,{id:"cotisation_cnss",type:"number",step:"0.01",value:s.cotisation_cnss,onChange:a=>l("cotisation_cnss",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"impot_revenu",children:"Impôt sur le revenu ($)"}),e.jsx(i,{id:"impot_revenu",type:"number",step:"0.01",value:s.impot_revenu,onChange:a=>l("impot_revenu",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"prets_retenus",children:"Prêts retenus ($)"}),e.jsx(i,{id:"prets_retenus",type:"number",step:"0.01",value:s.prets_retenus,onChange:a=>l("prets_retenus",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"avance_salaire",children:"Avance sur salaire ($)"}),e.jsx(i,{id:"avance_salaire",type:"number",step:"0.01",value:s.avance_salaire,onChange:a=>l("avance_salaire",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"paie_negative",children:"Paie négative ($)"}),e.jsx(i,{id:"paie_negative",type:"number",step:"0.01",value:s.paie_negative,onChange:a=>l("paie_negative",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"autres_regularisations",children:"Autres retenues ($)"}),e.jsx(i,{id:"autres_regularisations",type:"number",step:"0.01",value:s.autres_regularisations,onChange:a=>l("autres_regularisations",parseFloat(a.target.value)||0)})]})]})]})]}),e.jsxs(v,{children:[e.jsx(f,{children:e.jsx(y,{children:"Récapitulatif"})}),e.jsxs(b,{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Rémunération brute"}),e.jsx(i,{value:N(h.remunerationBrute),readOnly:!0,className:"bg-green-50 font-bold text-green-600"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Total retenues"}),e.jsx(i,{value:N(h.totalRetenues),readOnly:!0,className:"bg-red-50 font-bold text-red-600"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{children:"Net à payer"}),e.jsx(i,{value:N(h.netAPayer),readOnly:!0,className:"bg-blue-50 font-bold text-blue-600 text-lg"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(g,{variant:"outline",type:"button",asChild:!0,children:e.jsx("a",{href:route("paies.index"),children:"Annuler"})}),e.jsx(g,{type:"submit",disabled:R,children:R?"Enregistrement...":r!=null&&r.id?"Mettre à jour":"Enregistrer"})]})]})}export{Qe as default};
