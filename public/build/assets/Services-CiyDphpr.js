import{r as i,d as L,j as e,H as Z}from"./app-BiR3H72c.js";import{C as n,a as h,b as j,d}from"./card-CtX8457h.js";import{D as ee}from"./date-range-picker-96m4Sstq.js";import{A as se}from"./app-layout-DXRwYbWn.js";import{S as te}from"./scroll-area-iQk4GMsN.js";import{B as A}from"./button-DfBT4842.js";import{S as f}from"./skeleton-D-MEqpc3.js";import{B as ae}from"./badge-NokOUrZG.js";import{T as re,a as ie,b as T,c as $}from"./tabs-DEApmZXv.js";import{S as le}from"./search-D5WKme3c.js";import{a as N}from"./breadcrumbs-CfH9HSk2.js";import{P as ne}from"./package-CMie0C_N.js";import{c as M}from"./createLucideIcon-AVJzoGs5.js";import{S as oe}from"./shopping-cart-CtXjzZ1W.js";import{D as de}from"./dollar-sign-rcGCAktf.js";import{T as ce}from"./trending-up-CTfoIeSh.js";import{R as B,C as E,X as I,Y as y,T as R,L as K,B as b}from"./generateCategoricalChart-ClOP-bqC.js";import{L as me,a as q}from"./LineChart-BVA5dta-.js";import{B as xe}from"./BarChart-CLEOG6BU.js";import"./app-BojVexQw.js";import"./utils-D-KgF5mV.js";import"./calendar-Bm37FrpH.js";import"./DayPicker-BNzRSgUN.js";import"./format-B6qNwQQI.js";import"./chevron-left-CImlN05b.js";import"./chevron-right-F_DONt-v.js";import"./chevron-down-C8aG4wQu.js";import"./index-C4BIJOdj.js";import"./index-CaoPq-lK.js";import"./index-D85psPK1.js";import"./index-DL4BAlbN.js";import"./label-C35PAQno.js";import"./index-DufLrpEQ.js";import"./popover-B0R-MFpt.js";import"./react-icons.esm-kK37FhDG.js";import"./fr-CLbTb0XB.js";import"./index-CHBa3DK4.js";import"./index-DZfrvXPy.js";import"./chevrons-up-down-D26-hiHV.js";import"./app-logo-icon-D1TxLKab.js";import"./calendar-CQ4TJ2Ye.js";import"./circle-alert-CxFuhzFA.js";import"./index-C-wqcDA1.js";import"./index-BdQq_4o_.js";import"./index-DZGh8cYj.js";import"./index-D-SBhKFM.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],pe=M("ChartColumn",ue);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],fe=M("Download",he);function cs({auth:p,services:c=[]}){const[a,t]=i.useState(c),[l,z]=i.useState(""),[o,V]=i.useState(null),[m,w]=i.useState(""),[x,S]=i.useState(""),[r,H]=i.useState(null),[C,_]=i.useState(!1),[g,Q]=i.useState(""),[k,F]=i.useState(!1),[W,G]=i.useState("overview");i.useEffect(()=>{c.length===0&&L.get(route("services.list")).then(s=>{Array.isArray(s.data)?t(s.data):(console.error("Expected array but got:",s.data),t([]))}).catch(s=>{console.error("Error fetching products:",s),t([])})},[c]),i.useEffect(()=>{if(!l)return;_(!0);const s={service_id:l,date_debut:m,date_fin:x};L.get(route("services.stats"),{params:s}).then(u=>{H(u.data);const J=a.find(O=>O.id===l);V(J||null)}).finally(()=>_(!1))},[l,m,x,a]);const D=()=>{w(""),S("")},U=()=>r!=null&&r.ventes_par_periode?r.ventes_par_periode.map(s=>({date:new Date(s.date).toLocaleDateString("fr-FR",{day:"numeric",month:"short"}),quantité:s.total_quantite,"Chiffre affaires":s.total_ca,Marge:parseFloat(r.stats.marge)/(r.ventes_par_periode.length||1)})):[],X=[{title:"Tableau de bord",href:route("dashboard")},{title:"Statistiques Services",href:route("statistiques.index")}],Y=async()=>{if(l){F(!0);try{const s=new URLSearchParams;s.append("service_id",l),m&&s.append("date_debut",m),x&&s.append("date_fin",x),s.append("export","pdf"),window.open(`${route("services.stats")}?${s.toString()}`,"_blank")}finally{F(!1)}}},v=a.filter(s=>s.name.toLowerCase().includes(g.toLowerCase())||s.ref.toLowerCase().includes(g.toLowerCase()));return e.jsxs(se,{auth:p,breadcrumbs:X,children:[e.jsx(Z,{title:"Statistiques des services"}),e.jsx("div",{className:"container mx-auto p-4 md:p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6",children:[e.jsxs(n,{className:"w-full lg:w-1/4 flex flex-col",children:[e.jsxs(h,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(j,{className:"text-lg",children:"Services"}),e.jsx(ae,{variant:"secondary",children:v.length})]}),e.jsxs("div",{className:"relative mt-2",children:[e.jsx(le,{className:"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Rechercher un service...",className:"w-full pl-10 pr-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary text-sm",value:g,onChange:s=>Q(s.target.value)})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden px-4",children:e.jsx(te,{className:"h-[500px] pr-2",children:e.jsx("div",{className:"space-y-2 pb-4",children:v.length>0?v.map(s=>e.jsx("button",{className:`w-full p-3 text-left rounded-lg transition-all duration-200 border ${l===s.id?"bg-primary text-primary-foreground border-primary shadow-md":"border-border hover:border-primary hover:bg-accent/50"}`,onClick:()=>z(s.id),children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.avatar_url?e.jsx("img",{src:s.avatar_url,className:"w-10 h-10 rounded-lg object-cover",alt:s.name}):e.jsx("div",{className:"w-10 h-10 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(N,{className:"w-6 h-6 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:s.name}),s.prix&&e.jsxs("p",{className:"text-xs font-semibold text-green-100",children:[parseFloat(s.prix).toFixed(2)," $"]})]})]})},s.id)):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ne,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Aucun service trouvé"})]})})})})]}),e.jsxs("div",{className:"w-full lg:w-3/4 space-y-4",children:[o&&e.jsx(n,{className:"bg-gradient-to-r from-primary/5 to-primary/10",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[o.avatar_url?e.jsx("img",{src:o.avatar_url,className:"w-16 h-16 rounded-lg object-cover",alt:o.name}):e.jsx("div",{className:"w-16 h-16 rounded-lg bg-muted flex items-center justify-center",children:e.jsx(N,{className:"w-8 h-8 text-muted-foreground"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-bold",children:o.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:o.description||"Aucune description"}),e.jsx("div",{className:"flex items-center gap-4 mt-1",children:o.prix&&e.jsxs("span",{className:"text-sm bg-green-100 text-green-800 px-2 py-1 rounded",children:["Prix: ",parseFloat(o.prix).toFixed(2)," $"]})})]})]})})}),e.jsxs(n,{children:[e.jsx(h,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx(j,{children:"Filtres de période"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(A,{onClick:D,variant:"outline",size:"sm",disabled:!m&&!x,children:"Réinitialiser"}),e.jsx(A,{onClick:Y,variant:"default",size:"sm",disabled:!l||C||k,className:"gap-2",children:k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Génération..."]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"w-4 h-4"}),"Exporter PDF"]})})]})]})}),e.jsx(d,{children:e.jsx(ee,{dateDebut:m,dateFin:x,setDateDebut:w,setDateFin:S,resetFilters:D})})]}),C?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[1,2,3].map(s=>e.jsx(n,{children:e.jsxs(d,{className:"p-4",children:[e.jsx(f,{className:"h-6 w-3/4 mb-2"}),e.jsx(f,{className:"h-8 w-1/2"})]})},s))}),e.jsxs(n,{children:[e.jsx(h,{children:e.jsx(f,{className:"h-6 w-1/3"})}),e.jsx(d,{children:e.jsx(f,{className:"h-64 w-full"})})]})]}):r?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(P,{title:"Quantité vendue",value:r.stats.total_vendu,icon:e.jsx(oe,{className:"w-5 h-5"}),trend:parseInt(r.stats.total_vendu)>0?"up":"neutral"}),e.jsx(P,{title:"Chiffre d'affaires",value:`${parseFloat(r.stats.chiffre_affaires).toFixed(2)} $`,icon:e.jsx(de,{className:"w-5 h-5"}),trend:parseFloat(r.stats.chiffre_affaires)>0?"up":"neutral"})]}),e.jsxs(re,{value:W,onValueChange:G,className:"w-full",children:[e.jsxs(ie,{className:"grid w-full grid-cols-2",children:[e.jsxs(T,{value:"overview",className:"gap-2",children:[e.jsx(pe,{className:"w-4 h-4"}),"Vue d'ensemble"]}),e.jsxs(T,{value:"succursales",className:"gap-2",children:[e.jsx(ce,{className:"w-4 h-4"}),"Par succursale"]})]}),e.jsx($,{value:"overview",className:"mt-4",children:e.jsxs(n,{children:[e.jsx(h,{children:e.jsx(j,{children:"Évolution des ventes"})}),e.jsx(d,{className:"h-80",children:e.jsx(B,{width:"100%",height:"100%",children:e.jsxs(me,{data:U(),children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(I,{dataKey:"date"}),e.jsx(y,{yAxisId:"left"}),e.jsx(y,{yAxisId:"right",orientation:"right"}),e.jsx(R,{formatter:(s,u)=>u==="Chiffre affaires"||u==="Marge"?[`${parseFloat(s).toFixed(2)}$`,u]:[s,u]}),e.jsx(K,{}),e.jsx(q,{yAxisId:"left",type:"monotone",dataKey:"quantité",stroke:"#3b82f6",strokeWidth:2,dot:{r:4},activeDot:{r:6}}),e.jsx(q,{yAxisId:"right",type:"monotone",dataKey:"Chiffre affaires",stroke:"#10b981",strokeWidth:2,dot:{r:4},activeDot:{r:6}})]})})})]})}),e.jsx($,{value:"succursales",className:"mt-4",children:e.jsx(je,{ventesParSuccursale:r.ventes_par_succursale})})]})]}):e.jsx(n,{className:"text-center py-12",children:e.jsxs(d,{children:[e.jsx(N,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Aucun service sélectionné"}),e.jsx("p",{className:"text-muted-foreground",children:"Veuillez sélectionner un service dans la liste pour voir ses statistiques"})]})})]})]})})]})}function P({title:p,value:c,icon:a,trend:t}){const l={up:"text-green-100",down:"text-red-600",neutral:"text-gray-600"};return e.jsx(n,{className:"group hover:shadow-lg transition-shadow duration-200",children:e.jsxs(d,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:p}),e.jsx("p",{className:"text-2xl font-bold",children:c||"0"})]}),e.jsx("div",{className:`p-3 rounded-full bg-primary/10 group-hover:bg-primary/20 transition-colors ${l[t||"neutral"]}`,children:a})]}),t&&t!=="neutral"&&e.jsxs("div",{className:`flex items-center mt-2 text-sm ${l[t]}`,children:[t==="up"?"↗":"↘"," ",t==="up"?"Augmentation":"Diminution"]})]})})}function je({ventesParSuccursale:p}){const c=p.map(a=>({name:a.nom,quantité:a.total_quantite,ca:parseFloat(a.total_ca),marge:parseFloat(a.marge)}));return e.jsxs(n,{children:[e.jsx(h,{children:e.jsx(j,{children:"Performance par succursale"})}),e.jsx(d,{className:"h-96",children:e.jsx(B,{width:"100%",height:"100%",children:e.jsxs(xe,{data:c,layout:"vertical",margin:{top:20,right:30,left:100,bottom:20},children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(I,{type:"number"}),e.jsx(y,{dataKey:"name",type:"category",tick:{fontSize:12,fontWeight:"bold"}}),e.jsx(R,{formatter:(a,t)=>t==="ca"||t==="marge"?[`${parseFloat(a).toFixed(2)}$`,t==="ca"?"Chiffre d'affaires":"Marge bénéficiaire"]:[a,"Quantité vendue"]}),e.jsx(K,{}),e.jsx(b,{dataKey:"quantité",name:"Quantité vendue",fill:"#3b82f6",radius:[0,4,4,0]}),e.jsx(b,{dataKey:"ca",name:"Chiffre d'affaires",fill:"#10b981",radius:[0,4,4,0]}),e.jsx(b,{dataKey:"marge",name:"Marge bénéficiaire",fill:"#8b5cf6",radius:[0,4,4,0]})]})})})]})}export{cs as default};
