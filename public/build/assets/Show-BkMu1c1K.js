import{r as h,t as v,j as e,d as B,u as U,H as X,L as T,b as Y}from"./app-BiR3H72c.js";import{B as m}from"./button-DfBT4842.js";import{C as D,a as E,b as M,d as R}from"./card-CtX8457h.js";import{B as H}from"./badge-NokOUrZG.js";import{A as Z,a as z,b as O,c as q}from"./app-layout-DXRwYbWn.js";import{I as g}from"./input-CBAXjYrY.js";import{L as b}from"./label-C35PAQno.js";import{T as ee,a as se,b as F,c as A,d as le,e as N}from"./table-CMAMKCJS.js";import{A as ie,a as re,b as te,c as ae,d as ne,e as de,f as oe,g as ce,h as me}from"./alert-dialog-BGz4gOWV.js";import{D as G,b as V,c as J,d as K,e as Q,f as xe}from"./dialog-C2xpyM_9.js";import{E as he}from"./eye-xwMsSdsH.js";import{P as ue}from"./pencil-BBfKa5zT.js";import{T as pe}from"./trash-2-DAGSehnZ.js";import{f as u}from"./format-B6qNwQQI.js";import{f as p}from"./fr-CLbTb0XB.js";import{C as je}from"./chevron-left-CImlN05b.js";import{P as fe}from"./printer-BiZH-sr0.js";import{P as Ne}from"./PuffLoader-DaQpjwog.js";import"./app-BojVexQw.js";import"./utils-D-KgF5mV.js";import"./breadcrumbs-CfH9HSk2.js";import"./createLucideIcon-AVJzoGs5.js";import"./index-CaoPq-lK.js";import"./index-DZGh8cYj.js";import"./index-C4BIJOdj.js";import"./chevron-down-C8aG4wQu.js";import"./index-D85psPK1.js";import"./index-DL4BAlbN.js";import"./index-D-SBhKFM.js";import"./chevron-right-F_DONt-v.js";import"./index-CHBa3DK4.js";import"./index-DZfrvXPy.js";import"./chevrons-up-down-D26-hiHV.js";import"./app-logo-icon-D1TxLKab.js";import"./calendar-CQ4TJ2Ye.js";import"./package-CMie0C_N.js";import"./circle-alert-CxFuhzFA.js";import"./index-DufLrpEQ.js";function ve({references:j,agentId:s,onRefresh:w,onEdit:l,flash:d}){const[o,c]=h.useState(null),[t,f]=h.useState(null),C=async r=>{c(r);try{await B.delete(`/api/references/${r}`),v.success("Référence supprimée avec succès."),w()}catch(x){console.error("Error deleting reference:",x),v.error("Une erreur est survenue lors de la suppression de la référence.")}finally{c(null)}};return d.error&&v.error(d.error),d.success&&v.success(d.success),e.jsxs("div",{className:"border rounded-lg overflow-hidden",children:[e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs(F,{children:[e.jsx(A,{children:"#"}),e.jsx(A,{children:"Nom"}),e.jsx(A,{children:"Téléphone"}),e.jsx(A,{children:"Email"}),e.jsx(A,{className:"text-right",children:"Actions"})]})}),e.jsxs(le,{children:[j.map((r,x)=>e.jsxs(F,{children:[e.jsx(N,{children:x+1}),e.jsx(N,{children:r.nom}),e.jsx(N,{children:r.telephone}),e.jsx(N,{children:r.email||"-"}),e.jsxs(N,{className:"text-right space-x-2",children:[e.jsx(m,{variant:"outline",size:"icon",onClick:()=>f(r),children:e.jsx(he,{className:"h-4 w-4"})}),e.jsx(m,{variant:"outline",size:"icon",onClick:()=>l(r),children:e.jsx(ue,{className:"h-4 w-4"})}),e.jsxs(ie,{children:[e.jsx(re,{asChild:!0,children:e.jsx(m,{variant:"destructive",size:"sm",disabled:o===r.id,children:e.jsx(pe,{className:"h-4 w-4"})})}),e.jsxs(te,{children:[e.jsxs(ae,{children:[e.jsx(ne,{children:"Supprimer la référence"}),e.jsx(de,{children:"Voulez-vous vraiment supprimer cette référence ?"})]}),e.jsxs(oe,{children:[e.jsx(ce,{children:"Annuler"}),e.jsx(me,{onClick:()=>C(r.id),disabled:o===r.id,children:o===r.id?"Suppression...":"Supprimer"})]})]})]})]})]},r.id)),j.length===0&&e.jsx(F,{children:e.jsx(N,{colSpan:5,className:"text-center py-4",children:"Aucune référence enregistrée"})})]})]}),e.jsx(G,{open:!!t,onOpenChange:r=>!r&&f(null),children:e.jsxs(V,{children:[e.jsxs(J,{children:[e.jsx(K,{children:"Informations de la référence"}),e.jsx(Q,{children:"Détails complets de la référence"})]}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Nom:"}),e.jsx("p",{children:t.nom})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Téléphone:"}),e.jsx("p",{children:t.telephone})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Email:"}),e.jsx("p",{children:t.email||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Fonction:"}),e.jsx("p",{children:t.fonction})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Créé le:"}),e.jsx("p",{children:u(new Date(t.created_at),"PPPp",{locale:p})})]}),t.updated_at!==t.created_at&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Mis à jour le:"}),e.jsx("p",{children:u(new Date(t.updated_at),"PP",{locale:p})})]})]})]})})]})}function ge({open:j,onClose:s,agentId:w,reference:l,onSuccess:d}){const{data:o,setData:c,post:t,patch:f,processing:C,errors:r,reset:x}=U({nom:(l==null?void 0:l.nom)||"",telephone:(l==null?void 0:l.telephone)||"",email:(l==null?void 0:l.email)||"",fonction:(l==null?void 0:l.fonction)||""});h.useEffect(()=>{l?c({nom:l.nom,telephone:l.telephone,email:l.email||"",fonction:l.fonction}):x()},[l]);const _=a=>{a.preventDefault();const y=l!=null&&l.id?`/api/references/${l.id}`:`/api/agents/${w}/references`;(l!=null&&l.id?f:t)(y,{onSuccess:()=>{d(),s()}})};return e.jsx(G,{open:j,onOpenChange:s,children:e.jsxs(V,{children:[e.jsx(J,{children:e.jsx(K,{children:l!=null&&l.id?"Modifier la référence":"Ajouter une référence"})}),e.jsx(Q,{children:"Ajout d'une personne de référence à l'agent"}),e.jsxs("form",{onSubmit:_,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"nom",children:"Nom *"}),e.jsx(g,{id:"nom",value:o.nom,onChange:a=>c("nom",a.target.value),required:!0}),r.nom&&e.jsx("p",{className:"text-sm text-red-600",children:r.nom})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"telephone",children:"Téléphone *"}),e.jsx(g,{id:"telephone",value:o.telephone,type:"number",onChange:a=>c("telephone",a.target.value),required:!0}),r.telephone&&e.jsx("p",{className:"text-sm text-red-600",children:r.telephone})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"fonction",children:"Profession *"}),e.jsx(g,{id:"fonction",value:o.fonction,onChange:a=>c("fonction",a.target.value),required:!0}),r.fonction&&e.jsx("p",{className:"text-sm text-red-600",children:r.fonction})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"email",children:"Email"}),e.jsx(g,{id:"email",type:"email",value:o.email,onChange:a=>c("email",a.target.value)}),r.email&&e.jsx("p",{className:"text-sm text-red-600",children:r.email})]}),e.jsxs(xe,{children:[e.jsx(m,{variant:"outline",onClick:s,type:"button",children:"Annuler"}),e.jsx(m,{type:"submit",disabled:C,children:l!=null&&l.id?"Modifier":"Ajouter"})]})]})]})})}function ts({auth:j,agent:s,flash:w}){var I,L,$;const l=i=>i.split(" ").map(n=>n[0]).join("").toUpperCase(),{setData:d,post:o,reset:c}=U({avatar:null,signature:null}),t=i=>{i.preventDefault(),o(route("personnels.update-media",s.ref),{onSuccess:()=>{d({avatar:null,signature:null}),c(),v.success("Medias mis à jour avec succès.")},onError:n=>{console.log(n),v.error("Une erreur est survenue lors de la mise à jour des médias.")},forceFormData:!0})},[f,C]=h.useState([]),[r,x]=h.useState(!1),[_,a]=h.useState(!1),[y,P]=h.useState(null),S=async()=>{x(!0);try{const i=await B.get(`/api/agents/${s.id}/references`);C(i.data)}catch(i){console.error("Error loading references:",i)}finally{x(!1)}};h.useEffect(()=>{S()},[s.id]);const W=i=>{Y.visit(route("contrats.show",i))};return e.jsxs(Z,{auth:j,breadcrumbs:[{title:"Accueil",href:route("dashboard")},{title:"Gestion du Personnel",href:route("personnels.index")},{title:"Détails de l'Agent",href:route("personnels.show",s.id)}],children:[e.jsx(X,{title:`Détails de l'Agent - ${s.nom} ${s.prenom}`}),e.jsxs("div",{className:"flex flex-1 flex-col gap-4 p-4 md:gap-8 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(T,{href:route("personnels.index"),children:e.jsx(m,{variant:"outline",children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsx("h2",{className:"font-semibold text-xl text-gray-800 leading-tight",children:"Détails de l'Agent"})]}),e.jsx(m,{variant:"outline",asChild:!0,children:e.jsxs(T,{href:route("agents.fiche-identification",s.ref),target:"_blank",children:[e.jsx(fe,{className:"mr-2 h-4 w-4"}),"Fiche Identification"]})}),e.jsx(T,{href:route("personnels.edit",s.ref),children:e.jsx(m,{variant:"default",children:"Modifier"})})]}),e.jsx("div",{className:"grid gap-6",children:e.jsx("div",{className:"overflow-hidden shadow-sm sm:rounded-lg",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsxs(D,{className:"w-full md:w-1/3",children:[e.jsxs(E,{className:"items-center",children:[e.jsxs("div",{className:"flex flex-row gap-2",children:[e.jsxs(z,{className:"h-24 w-24",children:[e.jsx(O,{src:s.avatar_url}),e.jsx(q,{children:l(`${s.nom} ${s.prenom}`)})]}),s.signature_url&&e.jsxs(z,{className:"h-24 w-24",children:[e.jsx(O,{src:s.signature_url}),e.jsx(q,{children:l(`${s.nom} ${s.prenom}`)})]})]}),e.jsxs(M,{className:"text-center mt-4 font-bold",children:[s.nom," ",s.postnom," ",s.prenom]}),e.jsx(H,{variant:s.statut==="actif"?"default":"destructive",children:s.statut})]}),e.jsxs(R,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Matricule"}),e.jsx("p",{className:"font-bold",children:s.matricule})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Email"}),e.jsx("p",{className:"font-bold",children:s.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Téléphone"}),e.jsx("p",{className:"font-bold",children:s.telephone||"Non spécifié"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Rôle"}),e.jsx("p",{className:"font-bold",children:s.role==="admin"?"Administrateur":s.role==="ressource_humaine"?"Ressource Humaine":s.role==="communicateur"?"Communicateur":s.role==="caissière"?"Caissière":s.role==="manager"?"Gestionnaire":s.role==="agent"?"Agent":s.role==="assistant_direction"?"Assistant Direction":s.role==="charge_vente_client"?"Charge vente client":s.role==="coiffeuse"?"Coiffeuse":s.role==="maquilleuse"?"Maquilleuse":s.role==="cleaner"?"Cleaner":s.role==="estheticienne"?"Esthéticienne":s.role==="prothesiste"?"Prothésiste":"Autre"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Succursale"}),e.jsx("p",{className:"font-bold",children:(I=s.succursale)==null?void 0:I.nom})]})]}),e.jsx("div",{className:"mt-6 flex flex-col gap-2 mb-2",children:e.jsxs("form",{onSubmit:t,encType:"multipart/form-data",children:[e.jsxs("div",{className:"flex flex-col gap-2 mb-2",children:[e.jsx(b,{children:s.avatar_url?"Modifier la photo":"Ajouter une photo"}),e.jsx(g,{type:"file",onChange:i=>{var n;return d("avatar",((n=i.target.files)==null?void 0:n[0])||null)},className:"file:",accept:"image/*"})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(b,{children:[" ",s.signature_url?"Modifier la signature":"Ajouter une signature"]}),e.jsx(g,{type:"file",onChange:i=>{var n;return d("signature",((n=i.target.files)==null?void 0:n[0])||null)},accept:"image/*"})]}),e.jsx(m,{type:"submit",className:"mt-2",children:"Enregistrer"})]})})]})]}),e.jsxs(D,{className:"w-full md:w-2/3",children:[e.jsx(E,{children:e.jsx(M,{children:"Informations Personnelles"})}),e.jsxs(R,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sexe"}),e.jsx("p",{className:"font-bold",children:s.sexe==="M"?"Masculin":"Féminin"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Date de Naissance"}),e.jsx("p",{className:"font-bold",children:u(new Date(s.date_naissance),"PPP",{locale:p})||"Non spécifiée"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Lieu de Naissance"}),e.jsx("p",{className:"font-bold",children:s.lieu_naissance||"Non spécifié"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"État Civil"}),e.jsx("p",{className:"font-bold",children:s.etat_civil||"Non spécifié"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Nombre d'enfants"}),e.jsx("p",{className:"font-bold",children:s.nombre_enfant||"Non spécifié"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Numéro CNSS"}),e.jsx("p",{className:"font-bold",children:s.numero_cnss||"Non spécifié"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Adresse"}),e.jsx("p",{className:"font-bold",children:s.adresse||"Non spécifiée"})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Origine"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Province"}),e.jsx("p",{className:"font-bold",children:s.province_origine||"Non spécifiée"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Territoire"}),e.jsx("p",{className:"font-bold",children:s.territoire_origine||"Non spécifié"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"District"}),e.jsx("p",{className:"font-bold",children:s.district_origine||"Non spécifié"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Commune"}),e.jsx("p",{className:"font-bold",children:s.commune_origine||"Non spécifiée"})]})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"font-medium mb-4",children:"Métadonnées"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Créé le"}),e.jsx("p",{className:"font-bold",children:u(new Date(s.created_at),"PPPp",{locale:p})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"par"}),e.jsx("p",{className:"font-bold",children:((L=s.created_by)==null?void 0:L.name)||"Système"})]}),s.updated_at!==s.created_at&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Modifié le"}),e.jsx("p",{className:"font-bold",children:u(new Date(s.updated_at),"PPPp",{locale:p})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"par"}),e.jsx("p",{className:"font-bold",children:(($=s.updated_by)==null?void 0:$.name)||"Non modifié"})]})]})]})]})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 mt-6",children:[e.jsxs(D,{className:"w-full md:w-1/3",children:[e.jsx(E,{children:e.jsx(M,{children:"Contrats"})}),e.jsx(R,{children:s.contrats.length>0?s.contrats.map(i=>{var n,k;return e.jsxs("div",{onClick:()=>W(i.ref),className:"mb-4 border-b pb-4 shadow-sm hover:shadow-md transition-all duration-300 cursor-pointer hover:bg-accent hover:text-accent-foreground hover:scale-105 hover:z-10 p-2 rounded-md text-white bg-gray-300",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Debut: ",e.jsx("span",{className:"font-bold",children:i.date_debut?u(new Date(i.date_debut),"PPP",{locale:p}):"N/A"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Fin: ",e.jsx("span",{className:"font-bold",children:i.date_fin?u(new Date(i.date_fin),"PPP",{locale:p}):"N/A"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Type: ",e.jsx("span",{className:"font-bold",children:i.type_contrat})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Fonction: ",e.jsx("span",{className:"font-bold",children:i.fonction})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Salaire: ",e.jsx("span",{className:"font-bold",children:i.salaire_base})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Actif: ",e.jsxs("span",{className:"font-bold",children:[" ",e.jsx(H,{variant:i.is_active?"default":"destructive",children:i.is_active?"Oui":"Non"})]})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Par: ",e.jsx("span",{className:"font-bold",children:(n=i.created_by)==null?void 0:n.name})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Affecté à: ",e.jsx("span",{className:"font-bold",children:(k=i.succursale)==null?void 0:k.nom})]})]},i.id)}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aucun contrat trouvé"})})]}),e.jsxs(D,{className:"w-full md:w-2/3 p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-medium",children:"Personnes de référence"}),e.jsx(m,{size:"sm",onClick:()=>{P(null),a(!0)},children:"Ajouter une référence"})]}),r?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(Ne,{})}):e.jsx(ve,{references:f,agentId:s.id,onRefresh:S,flash:w,onEdit:i=>{P(i),a(!0)}})]})]}),e.jsx(ge,{open:_,onClose:()=>a(!1),agentId:s.id,reference:y,onSuccess:S})]})})})]})]})}export{ts as default};
