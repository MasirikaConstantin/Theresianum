import{r,d as b,j as e,H as B,b as M}from"./app-BiR3H72c.js";import{A as E}from"./app-layout-DXRwYbWn.js";import{B as g}from"./button-DfBT4842.js";import{C as c,a as o,b as x,d as m}from"./card-CtX8457h.js";import{T as L,a as R,b as y,c as a,d as k,e as i}from"./table-CMAMKCJS.js";import{B as n}from"./badge-NokOUrZG.js";import{P as q}from"./PuffLoader-DaQpjwog.js";import{f as C}from"./format-B6qNwQQI.js";import{f as w}from"./fr-CLbTb0XB.js";import"./app-BojVexQw.js";import"./breadcrumbs-CfH9HSk2.js";import"./createLucideIcon-AVJzoGs5.js";import"./index-CaoPq-lK.js";import"./utils-D-KgF5mV.js";import"./index-DZGh8cYj.js";import"./index-C4BIJOdj.js";import"./chevron-down-C8aG4wQu.js";import"./index-D85psPK1.js";import"./index-DL4BAlbN.js";import"./index-D-SBhKFM.js";import"./chevron-right-F_DONt-v.js";import"./index-CHBa3DK4.js";import"./index-DZfrvXPy.js";import"./chevrons-up-down-D26-hiHV.js";import"./app-logo-icon-D1TxLKab.js";import"./calendar-CQ4TJ2Ye.js";import"./package-CMie0C_N.js";import"./circle-alert-CxFuhzFA.js";function fe({auth:N,client:D}){var f,p,u;const[s,P]=r.useState(D),[T,$]=r.useState([]),[l,A]=r.useState({}),[F,h]=r.useState(!1);r.useEffect(()=>{j()},[]);const j=async()=>{h(!0);try{const t=await b.get(`/api/fidelite/${s.id}`);P(t.data.client),$(t.data.ventes),A(t.data.stats)}catch(t){console.error(t)}finally{h(!1)}},H=async()=>{try{await b.post(`/api/fidelite/${s.id}/cadeau`),j()}catch(t){console.error(t)}},S=[{title:"Fidélité",href:"/fidelite"},{title:s.name,href:`/fidelite/${s.id}`}];return e.jsxs(E,{auth:N,breadcrumbs:S,children:[e.jsx(B,{title:`Fidélité - ${s.name}`}),e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:s.name}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(n,{variant:"outline",children:s.telephone||"Aucun"}),e.jsx(n,{variant:"outline",children:s.email||"Aucun"}),s.date_naissance&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{variant:"outline",children:["Anniversaire: ",C(new Date(s.date_naissance),"PPP",{locale:w})]}),e.jsxs(n,{variant:"outline",children:["Âge: ",s.age," ans"]})]})]})]}),s.date_naissance&&new Date(s.date_naissance).getMonth()===new Date().getMonth()&&new Date(s.date_naissance).getDate()===new Date().getDate()&&e.jsx(g,{onClick:H,disabled:(f=s.fidelite)==null?void 0:f.a_recu_cadeau_anniversaire,children:(p=s.fidelite)!=null&&p.a_recu_cadeau_anniversaire?"Cadeau déjà offert":"Offrir cadeau d'anniversaire"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(c,{children:[e.jsx(o,{children:e.jsx(x,{children:"Points de fidélité"})}),e.jsx(m,{children:e.jsx("div",{className:"text-3xl font-bold",children:((u=s.fidelite)==null?void 0:u.points)||0})})]}),e.jsxs(c,{children:[e.jsx(o,{children:e.jsx(x,{children:"Total achats"})}),e.jsxs(m,{children:[e.jsxs("div",{className:"text-3xl font-bold",children:[l.total_depense||0,"  $"]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[l.total_ventes||0," commandes"]})]})]}),e.jsxs(c,{children:[e.jsx(o,{children:e.jsx(x,{children:"Moyenne par achat"})}),e.jsx(m,{children:e.jsxs("div",{className:"text-3xl font-bold",children:[l.moyenne_achat?parseFloat(l.moyenne_achat).toFixed(2):0,"  $"]})})]})]}),e.jsxs(c,{children:[e.jsx(o,{children:e.jsx(x,{children:"Historique des achats"})}),e.jsx(m,{children:F?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(q,{color:"#000",size:100})}):e.jsxs(L,{children:[e.jsx(R,{children:e.jsxs(y,{children:[e.jsx(a,{children:"Date"}),e.jsx(a,{children:"Référence"}),e.jsx(a,{children:"Montant"}),e.jsx(a,{children:"Mode de paiement"}),e.jsx(a,{children:"Articles"}),e.jsx(a,{children:"Actions"})]})}),e.jsx(k,{children:T.map(t=>e.jsxs(y,{children:[e.jsx(i,{children:C(new Date(t.created_at),"PPP",{locale:w})}),e.jsx(i,{children:t.code}),e.jsxs(i,{children:[t.montant_total,"  $"]}),e.jsx(i,{children:e.jsx(n,{variant:"outline",children:t.mode_paiement})}),e.jsx(i,{children:t.items.map(d=>{var v,_;return e.jsxs("div",{className:"text-sm",children:[d.quantite,"x ",((v=d.produit)==null?void 0:v.name)||((_=d.service)==null?void 0:_.name)]},d.id)})}),e.jsx(i,{children:e.jsx(g,{variant:"outline",onClick:()=>M.visit(`/ventes/${t.ref}`),children:"Voir"})})]},t.id))})]})})]})]})]})}export{fe as default};
