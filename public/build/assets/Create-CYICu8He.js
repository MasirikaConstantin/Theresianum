import{u as S,r as n,j as e,H as N,L as F,t as c}from"./app-BiR3H72c.js";import{B as x}from"./button-DfBT4842.js";import{I as h}from"./input-CBAXjYrY.js";import{L as o}from"./label-C35PAQno.js";import{T as y}from"./textarea-CIxwVg30.js";import{S as C,a as _,b as D,c as A,d as E}from"./select-B5KxOem9.js";import{A as I}from"./app-layout-DXRwYbWn.js";import{C as L,a as $,b as w,d as U}from"./card-CtX8457h.js";import{A as R,b as T,a as q}from"./alert-CJytHgmU.js";import{W as H}from"./breadcrumbs-CfH9HSk2.js";import{C as B}from"./circle-alert-CxFuhzFA.js";import"./app-BojVexQw.js";import"./utils-D-KgF5mV.js";import"./index-DufLrpEQ.js";import"./index-CaoPq-lK.js";import"./index-BdQq_4o_.js";import"./index-C4BIJOdj.js";import"./index-CHBa3DK4.js";import"./index-DZfrvXPy.js";import"./chevron-down-C8aG4wQu.js";import"./index-D85psPK1.js";import"./index-DL4BAlbN.js";import"./createLucideIcon-AVJzoGs5.js";import"./index-Di7OUUGl.js";import"./index-D-SBhKFM.js";import"./check-DVZ7LPyx.js";import"./chevrons-up-down-D26-hiHV.js";import"./app-logo-icon-D1TxLKab.js";import"./calendar-CQ4TJ2Ye.js";import"./package-CMie0C_N.js";import"./badge-NokOUrZG.js";import"./index-DZGh8cYj.js";import"./chevron-right-F_DONt-v.js";function ge({caisses:d,auth:f}){const j=[{title:"Dashboard",href:"/dashboard"},{title:"Depenses",href:"/depenses"},{title:"Nouvelle dépense",href:"#"}],{data:s,setData:l,post:b,processing:g,errors:i}=S({caisse_id:"",libelle:"",montant:"",description:""}),[r,p]=n.useState(null),[m,u]=n.useState(!1);n.useEffect(()=>{if(s.caisse_id){const t=d.find(a=>a.id.toString()===s.caisse_id);p(t||null)}else p(null)},[s.caisse_id,d]),n.useEffect(()=>{if(r&&s.montant){const t=parseFloat(s.montant)||0;u(t>parseFloat(r.solde))}else u(!1)},[s.montant,r]);const v=t=>{if(t.preventDefault(),m){c.error("Le montant dépasse le solde disponible de la caisse");return}if(parseFloat(s.montant)<=0){c.error("Le montant doit être supérieur à 0");return}b(route("depenses.store"),{onError:()=>{c.error("Erreur lors de l'enregistrement de la dépense")}})};return e.jsxs(I,{auth:f,breadcrumbs:j,children:[e.jsx(N,{title:"Enregistrer une dépense"}),e.jsx("div",{className:"container py-6 px-4",children:e.jsxs(L,{children:[e.jsx($,{className:"flex items-center justify-between mb-6",children:e.jsxs(w,{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(H,{className:"h-6 w-6"}),"Nouvelle dépense"]})}),e.jsx(U,{children:e.jsxs("div",{className:" ",children:[m&&e.jsxs(R,{variant:"destructive",className:"mb-6 bg-red-300",children:[e.jsx(B,{className:"h-4 w-4"}),e.jsx(T,{children:"Attention"}),e.jsxs(q,{children:["Le montant saisi dépasse le solde disponible de cette caisse. Solde actuel: ",new Intl.NumberFormat("fr-FR",{style:"currency",currency:"USD"}).format(parseFloat(r==null?void 0:r.solde)).replace("$US","$")]})]}),e.jsxs("form",{onSubmit:v,className:"space-y-6 ",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"caisse_id",children:"Caisse"}),e.jsxs(C,{value:s.caisse_id,onValueChange:t=>l("caisse_id",t),required:!0,children:[e.jsx(_,{children:e.jsx(D,{placeholder:"Sélectionner une caisse"})}),e.jsx(A,{children:d.map(t=>{var a;return e.jsxs(E,{value:t.id.toString(),disabled:parseFloat(t.solde)<=0,children:[(a=t.succursale)==null?void 0:a.nom," - Solde: ",new Intl.NumberFormat("fr-FR",{style:"currency",currency:"USD"}).format(parseFloat(t.solde)).replace("$US","$")]},t.id)})})]}),i.caisse_id&&e.jsx("p",{className:"text-sm text-red-500",children:i.caisse_id})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"libelle",children:"Raison"}),e.jsx(h,{id:"libelle",value:s.libelle,onChange:t=>l("libelle",t.target.value),required:!0}),i.libelle&&e.jsx("p",{className:"text-sm text-red-500",children:i.libelle})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"montant",children:"Montant ($)"}),e.jsx(h,{id:"montant",type:"number",step:"0.01",min:"0.01",value:s.montant,onChange:t=>{const a=t.target.value;parseFloat(a)>=0&&l("montant",a)},required:!0}),i.montant&&e.jsx("p",{className:"text-sm text-red-500",children:i.montant}),r&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Solde disponible: ",new Intl.NumberFormat("fr-FR",{style:"currency",currency:"USD"}).format(parseFloat(r.solde)).replace("$US","$")]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(o,{htmlFor:"description",children:"Description (optionnel)"}),e.jsx(y,{id:"description",value:s.description,onChange:t=>l("description",t.target.value)})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 ",children:[e.jsx(x,{type:"button",variant:"outline",asChild:!0,children:e.jsx(F,{href:route("depenses.index"),children:"Annuler"})}),e.jsx(x,{type:"submit",disabled:g||m,children:"Enregistrer la dépense"})]})]})]})})]})})]})}export{ge as default};
