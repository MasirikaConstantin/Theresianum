import{r as n,t as m,d as C,j as e,H as k,L as b}from"./app-BiR3H72c.js";import{A as B}from"./app-layout-DXRwYbWn.js";import{B as c}from"./button-DfBT4842.js";import{C as h,a as x,b as j,d as u}from"./card-CtX8457h.js";import{T as E,a as H,b as N,c as i,d as M,e as a}from"./table-CMAMKCJS.js";import{B as T}from"./badge-NokOUrZG.js";import{I as z}from"./input-CBAXjYrY.js";import{P as F}from"./PuffLoader-DaQpjwog.js";import{E as I}from"./eye-xwMsSdsH.js";import{f as R}from"./format-B6qNwQQI.js";import{f as O}from"./fr-CLbTb0XB.js";import"./app-BojVexQw.js";import"./breadcrumbs-CfH9HSk2.js";import"./createLucideIcon-AVJzoGs5.js";import"./index-CaoPq-lK.js";import"./utils-D-KgF5mV.js";import"./index-DZGh8cYj.js";import"./index-C4BIJOdj.js";import"./chevron-down-C8aG4wQu.js";import"./index-D85psPK1.js";import"./index-DL4BAlbN.js";import"./index-D-SBhKFM.js";import"./chevron-right-F_DONt-v.js";import"./index-CHBa3DK4.js";import"./index-DZfrvXPy.js";import"./chevrons-up-down-D26-hiHV.js";import"./app-logo-icon-D1TxLKab.js";import"./calendar-CQ4TJ2Ye.js";import"./package-CMie0C_N.js";import"./circle-alert-CxFuhzFA.js";function ge({auth:w,flash:d}){const[y,D]=n.useState([]),[P,p]=n.useState(!0),[l,A]=n.useState({}),[t,f]=n.useState("all"),[o,S]=n.useState("");d.error&&m.error(d.error),d.success&&m.success(d.success),n.useEffect(()=>{const s=setTimeout(()=>{v()},500);return()=>clearTimeout(s)},[t,o]);const v=async()=>{p(!0);try{const s={};t==="anniversaire"&&(s.anniversaire=!0),t==="meilleurs"&&(s.meilleurs=!0),o&&(s.search=o);const r=await C.get("/api/fidelite",{params:s});D(r.data),A(r.data.stats)}catch(s){console.error(s)}finally{p(!1)}},L=async s=>{try{const r=await C.post(`/api/fidelite/${s}/cadeau`);v(),r.data.success&&m.success(r.data.success),r.data.error&&m.error(r.data.error)}catch(r){console.error(r)}},$=[{title:"Programme de fidélité",href:"/fidelite"}];return e.jsxs(B,{auth:w,breadcrumbs:$,children:[e.jsx(k,{title:"Programme de fidélité"}),e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Programme de fidélité"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{placeholder:"Rechercher un client...",value:o,onChange:s=>S(s.target.value),className:"w-64"}),e.jsx(c,{variant:t==="all"?"default":"outline",onClick:()=>f("all"),children:"Tous les clients"}),e.jsx(c,{variant:t==="anniversaire"?"default":"outline",onClick:()=>f("anniversaire"),children:"Anniversaires"}),e.jsx(c,{variant:t==="meilleurs"?"default":"outline",onClick:()=>f("meilleurs"),children:"Meilleurs clients"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(h,{children:[e.jsx(x,{children:e.jsx(j,{children:"Clients fidèles"})}),e.jsx(u,{children:e.jsx("div",{className:"text-3xl font-bold",children:l.total_clients})})]}),e.jsxs(h,{children:[e.jsx(x,{children:e.jsx(j,{children:"Anniversaires aujourd'hui"})}),e.jsx(u,{children:e.jsx("div",{className:"text-3xl font-bold",children:l.clients_anniversaire})})]}),e.jsxs(h,{children:[e.jsx(x,{children:e.jsx(j,{children:"Meilleur client"})}),e.jsx(u,{children:l.meilleur_client?e.jsxs("div",{children:[e.jsx("div",{className:"font-bold",children:l.meilleur_client.client.name}),e.jsxs("div",{children:[l.meilleur_client.montant_total_achats," $ dépensés"]})]}):e.jsx("div",{children:"Aucun client"})})]})]}),e.jsxs(h,{children:[e.jsx(x,{children:e.jsx(j,{children:"Liste des clients"})}),e.jsx(u,{children:P?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(F,{color:"#000",size:100})}):e.jsxs(E,{children:[e.jsx(H,{children:e.jsxs(N,{children:[e.jsx(i,{children:"#"}),e.jsx(i,{children:"Client"}),e.jsx(i,{children:"Contact"}),e.jsx(i,{children:"Date de naissance"}),e.jsx(i,{children:"Points"}),e.jsx(i,{children:"Total achats"}),e.jsx(i,{children:"Actions"})]})}),e.jsx(M,{children:Object.values(y).slice(0,-1).map((s,r)=>{var g,_;return e.jsxs(N,{children:[e.jsx(a,{children:r+1}),e.jsx(a,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{href:`/fidelite/${s.ref}`,className:"hover:underline",children:s.name}),s.anniversaire_proche&&e.jsx(T,{variant:"destructive",children:s.jours_avant_anniversaire===0?"Aujourd'hui":`Dans ${Math.ceil(s.jours_avant_anniversaire)} j`})]})}),e.jsxs(a,{children:[e.jsx("div",{children:s.telephone}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.email})]}),e.jsx(a,{children:s.date_naissance?R(new Date(s.date_naissance),"PPP",{locale:O}):"Aucune "}),e.jsx(a,{children:e.jsxs(T,{variant:"outline",children:[((g=s.fidelite)==null?void 0:g.points)||0," pts"]})}),e.jsxs(a,{children:[((_=s.fidelite)==null?void 0:_.montant_total_achats)||0," $"]}),e.jsx(a,{children:e.jsxs(e.Fragment,{children:[e.jsx(b,{href:`/fidelite/${s.ref}`,className:"mr-2",children:e.jsx(c,{size:"sm",variant:"outline",children:e.jsx(I,{className:"h-4 w-4"})})}),s.date_naissance&&new Date(s.date_naissance).getMonth()===new Date().getMonth()&&new Date(s.date_naissance).getDate()===new Date().getDate()&&e.jsx(c,{size:"sm",onClick:()=>L(s.id),children:"Offrir cadeau"})]})})]},r)})})]})})]})]})]})}export{ge as default};
