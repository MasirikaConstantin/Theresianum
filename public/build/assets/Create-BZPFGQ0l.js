import{u as G,r as p,j as s,H as J,L as K,t as h}from"./app-BiR3H72c.js";import{A as O}from"./app-layout-DXRwYbWn.js";import{B as x}from"./button-DfBT4842.js";import{L as u}from"./label-C35PAQno.js";import{I as L}from"./input-CBAXjYrY.js";import{S as j,a as f,b as _,c as g,d as v}from"./select-B5KxOem9.js";import{C as S,a as k,b as C,d as w}from"./card-CtX8457h.js";import{B as V}from"./badge-NokOUrZG.js";import{A as E,a as P}from"./alert-CJytHgmU.js";import{P as X}from"./plus-BhylbLjU.js";import{T as y}from"./triangle-alert-5Oq9jqv_.js";import{T as Y}from"./trash-2-DAGSehnZ.js";import{c as Z}from"./createLucideIcon-AVJzoGs5.js";import"./app-BojVexQw.js";import"./breadcrumbs-CfH9HSk2.js";import"./index-CaoPq-lK.js";import"./utils-D-KgF5mV.js";import"./index-DZGh8cYj.js";import"./index-C4BIJOdj.js";import"./chevron-down-C8aG4wQu.js";import"./index-D85psPK1.js";import"./index-DL4BAlbN.js";import"./index-D-SBhKFM.js";import"./chevron-right-F_DONt-v.js";import"./index-CHBa3DK4.js";import"./index-DZfrvXPy.js";import"./chevrons-up-down-D26-hiHV.js";import"./app-logo-icon-D1TxLKab.js";import"./calendar-CQ4TJ2Ye.js";import"./package-CMie0C_N.js";import"./circle-alert-CxFuhzFA.js";import"./index-DufLrpEQ.js";import"./index-BdQq_4o_.js";import"./index-Di7OUUGl.js";import"./check-DVZ7LPyx.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],D=Z("ArrowRightLeft",ss),es=[{title:"Dashboard",href:"/dashboard"},{title:"Transferts",href:"/transferts"},{title:"Nouveau transfert",href:"#"}];function Bs({auth:q,produits:I,succursales:N,users:ts,stocks:F,masuccursales:$}){const{data:i,setData:d,post:B,processing:z,errors:a}=G({note:"",items:[{produit_id:"",quantite:1,succursale_source_id:"",succursale_destination_id:""}]}),c=q.user.succursale_id,[b,rs]=p.useState(F||{}),[o,R]=p.useState({});p.useEffect(()=>{if(c&&i.items[0].succursale_source_id===""){const e=[...i.items];e.forEach(t=>{t.succursale_source_id===""&&(t.succursale_source_id=c.toString())}),d("items",e)}},[c]),p.useEffect(()=>{const e={};i.items.forEach((t,r)=>{var n;if(t.produit_id&&t.succursale_source_id){const U=((n=b[t.produit_id])==null?void 0:n[t.succursale_source_id])||0;e[r]=t.quantite>U}}),R(e)},[i.items,b]);const H=()=>{d("items",[...i.items,{produit_id:"",quantite:1,succursale_source_id:(c==null?void 0:c.toString())||"",succursale_destination_id:""}])},Q=e=>{if(i.items.length<=1)return;const t=[...i.items];t.splice(e,1),d("items",t)},l=(e,t,r)=>{const n=[...i.items];n[e][t]=r,t==="produit_id"&&(n[e].quantite=1),d("items",n)},m=(e,t)=>{var r;return((r=b[e])==null?void 0:r[t])||0},M=e=>{const t=I.find(r=>r.id.toString()===e);return t?t.name:""},A=e=>{const t=N.find(r=>r.id.toString()===e);return t?t.nom:""},W=e=>{if(e.preventDefault(),i.items.some((r,n)=>o[n])){h.error("Certains articles dépassent le stock disponible. Veuillez vérifier les quantités.");return}B(route("transferts.store"),{onSuccess:()=>h.success("Transfert créé avec succès"),onError:r=>{r.message?h.error(r.message):h.error("Une erreur est survenue")}})},T=e=>e.produit_id&&e.quantite&&e.succursale_source_id&&e.succursale_destination_id;return s.jsxs(O,{auth:q,breadcrumbs:es,children:[s.jsx(J,{title:"Nouveau transfert"}),s.jsx("div",{className:"flex flex-1 flex-col gap-4 p-4 md:gap-8 md:p-6",children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsxs("div",{className:"lg:col-span-2",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Nouveau transfert"}),s.jsx(K,{href:route("transferts.index"),children:s.jsx(x,{variant:"outline",children:"Retour à la liste"})})]}),s.jsxs("form",{onSubmit:W,className:"grid gap-6",children:[s.jsxs(S,{children:[s.jsx(k,{children:s.jsx(C,{children:"Informations générales"})}),s.jsx(w,{children:s.jsxs("div",{className:"grid gap-2",children:[s.jsx(u,{htmlFor:"note",children:"Note (optionnel)"}),s.jsx(L,{id:"note",value:i.note,onChange:e=>d("note",e.target.value),placeholder:"Informations complémentaires sur ce transfert..."}),a.note&&s.jsx("p",{className:"text-sm font-medium text-destructive",children:a.note})]})})]}),s.jsxs(S,{children:[s.jsxs(k,{className:"flex flex-row items-center justify-between",children:[s.jsx(C,{children:"Produits à transférer"}),s.jsxs(x,{type:"button",size:"sm",onClick:H,children:[s.jsx(X,{className:"mr-2 h-4 w-4"}),"Ajouter un produit"]})]}),s.jsxs(w,{children:[i.items.map((e,t)=>s.jsxs("div",{className:"mb-6 p-4 border rounded-lg bg-muted/30",children:[s.jsxs("div",{className:"flex justify-between items-center mb-4",children:[s.jsxs("h4",{className:"font-medium flex items-center",children:["Produit #",t+1,o[t]&&s.jsxs(V,{variant:"destructive",className:"ml-2",children:[s.jsx(y,{className:"h-3 w-3 mr-1"}),"Stock insuffisant"]})]}),i.items.length>1&&s.jsx(x,{type:"button",variant:"ghost",size:"sm",onClick:()=>Q(t),children:s.jsx(Y,{className:"h-4 w-4 text-destructive"})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(u,{htmlFor:`produit-${t}`,children:"Produit"}),s.jsxs(j,{value:e.produit_id,onValueChange:r=>l(t,"produit_id",r),children:[s.jsx(f,{children:s.jsx(_,{placeholder:"Sélectionner un produit"})}),s.jsx(g,{children:I.map(r=>s.jsx(v,{value:r.id.toString(),children:r.name},r.id))})]}),a[`items.${t}.produit_id`]&&s.jsx("p",{className:"text-sm font-medium text-destructive",children:a[`items.${t}.produit_id`]})]}),s.jsxs("div",{className:"grid gap-2",children:[s.jsxs(u,{htmlFor:`quantite-${t}`,children:["Quantité",e.produit_id&&e.succursale_source_id&&s.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:["(Stock disponible: ",m(e.produit_id,e.succursale_source_id),")"]})]}),s.jsx(L,{id:`quantite-${t}`,type:"number",min:"1",max:e.produit_id&&e.succursale_source_id?m(e.produit_id,e.succursale_source_id):void 0,value:e.quantite,onChange:r=>l(t,"quantite",parseInt(r.target.value)||1),className:o[t]?"border-destructive":""}),a[`items.${t}.quantite`]&&s.jsx("p",{className:"text-sm font-medium text-destructive",children:a[`items.${t}.quantite`]}),o[t]&&s.jsx("p",{className:"text-sm font-medium text-destructive",children:"Quantité supérieure au stock disponible"})]})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-center",children:[s.jsxs("div",{className:"grid gap-2",children:[s.jsx(u,{htmlFor:`source-${t}`,children:"Branche source"}),$?s.jsxs(j,{value:e.succursale_source_id,onValueChange:r=>l(t,"succursale_source_id",r),children:[s.jsx(f,{children:s.jsx(_,{placeholder:"Source"})}),s.jsx(g,{children:$.map(r=>s.jsxs(v,{value:r.id.toString(),disabled:r.id.toString()===e.succursale_destination_id,children:[r.nom,r.id.toString()===(c==null?void 0:c.toString())&&" (Votre succursale)"]},r.id))})]}):s.jsxs(j,{value:e.succursale_source_id,onValueChange:r=>l(t,"succursale_source_id",r),children:[s.jsx(f,{children:s.jsx(_,{placeholder:"Source"})}),s.jsx(g,{children:N.map(r=>s.jsxs(v,{value:r.id.toString(),disabled:r.id.toString()===e.succursale_destination_id,children:[r.nom,r.id.toString()===(c==null?void 0:c.toString())&&" (Votre succursale)"]},r.id))})]}),a[`items.${t}.succursale_source_id`]&&s.jsx("p",{className:"text-sm font-medium text-destructive",children:a[`items.${t}.succursale_source_id`]})]}),s.jsx("div",{className:"flex items-center gap-1",children:s.jsx(D,{className:"h-5 w-5 mx-auto hidden md:block"})}),s.jsxs("div",{className:"grid gap-2 ",children:[s.jsx(u,{htmlFor:`destination-${t}`,children:"Branche destination"}),s.jsxs(j,{value:e.succursale_destination_id,onValueChange:r=>l(t,"succursale_destination_id",r),children:[s.jsx(f,{children:s.jsx(_,{placeholder:"Destination"})}),s.jsx(g,{children:N.map(r=>s.jsx(v,{value:r.id.toString(),disabled:r.id.toString()===e.succursale_source_id,children:r.nom},r.id))})]}),a[`items.${t}.succursale_destination_id`]&&s.jsx("p",{className:"text-sm font-medium text-destructive",children:a[`items.${t}.succursale_destination_id`]})]})]}),e.produit_id&&e.succursale_source_id&&e.quantite>m(e.produit_id,e.succursale_source_id)&&s.jsxs(E,{variant:"destructive",className:"mt-4",children:[s.jsx(y,{className:"h-4 w-4"}),s.jsxs(P,{children:["Attention: La quantité demandée (",e.quantite,") dépasse le stock disponible (",m(e.produit_id,e.succursale_source_id),")"]})]})]},t)),a.items&&s.jsx("p",{className:"text-sm font-medium text-destructive",children:a.items})]})]}),s.jsx("div",{className:"flex justify-end gap-2",children:s.jsx(x,{type:"submit",disabled:z,children:"Enregistrer le transfert"})})]})]}),s.jsx("div",{className:"lg:col-span-1",children:s.jsxs(S,{className:"sticky top-4",children:[s.jsx(k,{children:s.jsx(C,{children:"Résumé du transfert"})}),s.jsx(w,{children:i.items.some(T)?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"text-sm mb-4",children:[i.note&&s.jsxs("div",{className:"mb-2",children:[s.jsx("span",{className:"font-medium",children:"Note:"})," ",i.note]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Total produits:"})," ",i.items.length]})]}),s.jsx("div",{className:"space-y-3",children:i.items.filter(T).map((e,t)=>s.jsxs("div",{className:"p-3 border rounded-md bg-background",children:[s.jsx("div",{className:"font-medium",children:M(e.produit_id)}),s.jsxs("div",{className:"text-sm text-muted-foreground mt-1",children:["Quantité: ",e.quantite]}),s.jsxs("div",{className:"text-xs mt-2 flex items-center",children:[s.jsx("span",{children:A(e.succursale_source_id)}),s.jsx(D,{className:"h-3 w-3 mx-2"}),s.jsx("span",{children:A(e.succursale_destination_id)})]}),o[t]&&s.jsx(V,{variant:"destructive",className:"mt-2 text-xs",children:"Stock insuffisant"})]},t))}),i.items.some((e,t)=>o[t])&&s.jsxs(E,{variant:"destructive",className:"mt-4",children:[s.jsx(y,{className:"h-4 w-4"}),s.jsx(P,{children:"Certains produits dépassent le stock disponible."})]})]}):s.jsx("div",{className:"text-center py-6 text-muted-foreground",children:"Complétez le formulaire pour voir le résumé du transfert"})})]})})]})})]})}export{Bs as default};
