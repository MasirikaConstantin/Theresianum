import{r as s,d as S,j as e,H}from"./app-BiR3H72c.js";import{C as m,a as u,b as x,d as f}from"./card-CtX8457h.js";import{D as M}from"./date-range-picker-96m4Sstq.js";import{A as z}from"./app-layout-DXRwYbWn.js";import{S as G}from"./scroll-area-iQk4GMsN.js";import{B as I}from"./button-DfBT4842.js";import{P as Q}from"./package-CMie0C_N.js";import{R as _,X as F,Y as L,T as P,L as k,B as p,C as V}from"./generateCategoricalChart-ClOP-bqC.js";import{B as D}from"./BarChart-CLEOG6BU.js";import"./app-BojVexQw.js";import"./utils-D-KgF5mV.js";import"./calendar-Bm37FrpH.js";import"./DayPicker-BNzRSgUN.js";import"./format-B6qNwQQI.js";import"./chevron-left-CImlN05b.js";import"./createLucideIcon-AVJzoGs5.js";import"./chevron-right-F_DONt-v.js";import"./chevron-down-C8aG4wQu.js";import"./index-C4BIJOdj.js";import"./index-CaoPq-lK.js";import"./index-D85psPK1.js";import"./index-DL4BAlbN.js";import"./label-C35PAQno.js";import"./index-DufLrpEQ.js";import"./popover-B0R-MFpt.js";import"./react-icons.esm-kK37FhDG.js";import"./fr-CLbTb0XB.js";import"./breadcrumbs-CfH9HSk2.js";import"./index-DZGh8cYj.js";import"./index-D-SBhKFM.js";import"./index-CHBa3DK4.js";import"./index-DZfrvXPy.js";import"./chevrons-up-down-D26-hiHV.js";import"./app-logo-icon-D1TxLKab.js";import"./calendar-CQ4TJ2Ye.js";import"./circle-alert-CxFuhzFA.js";import"./badge-NokOUrZG.js";import"./index-C-wqcDA1.js";import"./index-BdQq_4o_.js";function qe({auth:l,produits:o=[]}){const[a,i]=s.useState(o),[n,$]=s.useState(""),[d,g]=s.useState(""),[c,v]=s.useState(""),[r,q]=s.useState(null),[A,b]=s.useState(!1),[y,E]=s.useState(""),[N,w]=s.useState(!1);s.useEffect(()=>{o.length===0&&S.get(route("produits.list")).then(t=>{Array.isArray(t.data)?i(t.data):(console.error("Expected array but got:",t.data),i([]))}).catch(t=>{console.error("Error fetching products:",t),i([])})},[o]),s.useEffect(()=>{if(!n)return;b(!0);const t={produit_id:n,date_debut:d,date_fin:c};S.get(route("produits.stats"),{params:t}).then(h=>{q(h.data)}).finally(()=>b(!1))},[n,d,c]);const B=()=>{g(""),v("")},K=()=>r!=null&&r.ventes_par_periode?r.ventes_par_periode.map(t=>({date:new Date(t.date).toLocaleDateString("fr-FR",{day:"numeric",month:"short"}),quantit√©:t.total_quantite,"Chiffre affaires":t.total_ca})):[],R=[{title:"Les Produits",href:route("statistiques.index")},{title:"Produits",href:route("produits.list")}],T=async()=>{if(n){w(!0);try{const t=new URLSearchParams;t.append("produit_id",n),d&&t.append("date_debut",d),c&&t.append("date_fin",c),t.append("export","pdf"),window.open(`${route("produits.stats")}?${t.toString()}`,"_blank")}finally{w(!1)}}},C=a.filter(t=>t.name.toLowerCase().includes(y.toLowerCase()));return e.jsxs(z,{auth:l,breadcrumbs:R,children:[e.jsx(H,{title:"Statistiques des produits"}),e.jsx("div",{className:"container mx-auto p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsxs(m,{className:"w-full md:w-1/3 flex flex-col",children:[e.jsxs(u,{children:[e.jsx(x,{children:"Produits"}),e.jsxs("div",{className:"relative mt-2",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un produit...",className:"w-full pl-10 pr-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary",value:y,onChange:t=>E(t.target.value)}),e.jsx("div",{className:"absolute left-3 top-2.5 text-muted-foreground",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden px-6",children:e.jsx(G,{className:"h-full pr-3",children:e.jsx("div",{className:"space-y-2 pb-4",children:C.length>0?C.map(t=>e.jsx("button",{className:`w-full p-3 text-left rounded-md transition-colors ${n===t.id?"bg-secondary text-card-foreground":"hover:bg-accent hover:text-accent-foreground"}`,onClick:()=>$(t.id),children:e.jsxs("div",{className:"flex items-center gap-3",children:[t.avatar_url?e.jsx("img",{src:t.avatar_url,className:"w-8 h-8 rounded-full",alt:t.name.split(" ").map(h=>h[0]).join("")}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center",children:e.jsx(Q,{className:"w-6 h-6 text-gray-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.description?t.description.slice(0,30)+"...":""})]})]})},t.id)):e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"Aucun produit trouv√©"})})})})]}),e.jsxs("div",{className:"w-full md:w-2/3 ",children:[e.jsxs(m,{className:"mb-2",children:[e.jsx(u,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(x,{children:"Filtres"}),e.jsx(I,{onClick:T,variant:"outline",disabled:!n||A||N,children:N?"G√©n√©ration...":"Exporter en PDF"})]})}),e.jsx(f,{children:e.jsx(M,{dateDebut:d,dateFin:c,setDateDebut:g,setDateFin:v,resetFilters:B})})]}),r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-2",children:[e.jsx(j,{title:"Quantit√© vendue",value:r.stats.total_vendu,icon:"üì¶"}),e.jsx(j,{title:"Chiffre d'affaires",value:`${parseFloat(r.stats.chiffre_affaires).toFixed(2)} $`,icon:"üí∞"}),e.jsx(j,{title:"Marge b√©n√©ficiaire",value:`${parseFloat(r.stats.marge).toFixed(2)} $`,icon:"üìà"})]}),e.jsxs(m,{className:"mb-2",children:[e.jsx(u,{children:e.jsx(x,{children:"Ventes par p√©riode"})}),e.jsx(f,{className:"h-80",children:e.jsx(_,{width:"100%",height:"100%",children:e.jsxs(D,{data:K(),children:[e.jsx(F,{dataKey:"date"}),e.jsx(L,{}),e.jsx(P,{}),e.jsx(k,{}),e.jsx(p,{dataKey:"quantit√©",fill:"#3b82f6"}),e.jsx(p,{dataKey:"Chiffre affaires",fill:"#10b981"})]})})})]})]}),r&&e.jsx(W,{ventesParSuccursale:r.ventes_par_succursale})]})]})})]})}function j({title:l,value:o,icon:a}){return e.jsxs(m,{children:[e.jsxs(u,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx("p",{className:"text-sm font-medium",children:l}),e.jsx("span",{className:"text-2xl",children:a})]}),e.jsx(f,{children:e.jsx("p",{className:"text-2xl font-bold",children:o||"-"})})]})}function W({ventesParSuccursale:l}){const o=l.map(a=>({name:a.nom,quantit√©:a.total_quantite,ca:parseFloat(a.total_ca),marge:parseFloat(a.marge)}));return e.jsxs(m,{className:"mb-2",children:[e.jsx(u,{children:e.jsx(x,{children:"Ventes par succursale"})}),e.jsx(f,{className:"h-80",children:e.jsx(_,{width:"100%",height:"100%",children:e.jsxs(D,{data:o,layout:"vertical",margin:{top:20,right:30,left:40,bottom:20},children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(F,{type:"number"}),e.jsx(L,{dataKey:"name",type:"category",width:100,tick:{fontSize:12,fontWeight:"bold",color:"black"}}),e.jsx(P,{formatter:(a,i)=>i==="ca"||i==="marge"?[`${parseFloat(a).toFixed(2)}$`,i]:[a,i]}),e.jsx(k,{}),e.jsx(p,{dataKey:"quantit√©",name:"Quantit√© vendue",fill:"#3b82f6",radius:[0,4,4,0]}),e.jsx(p,{dataKey:"ca",name:"Chiffre d'affaires ($)",fill:"#10b981",radius:[0,4,4,0]}),e.jsx(p,{dataKey:"marge",name:"Marge b√©n√©ficiaire ($)",fill:"#8b5cf6",radius:[0,4,4,0]})]})})})]})}export{qe as default};
