import{r as P,u as V,a as B,t as l,j as e,H,L as N}from"./app-BiR3H72c.js";import{A as Q}from"./app-layout-DXRwYbWn.js";import{B as c}from"./button-DfBT4842.js";import{C as $,a as z,b as F,d as R}from"./card-CtX8457h.js";import{I as S}from"./input-CBAXjYrY.js";import{L as d}from"./label-C35PAQno.js";import{S as _,a as C,b as k,c as q,d as y}from"./select-B5KxOem9.js";import{T as O}from"./trash-ytvtsJAQ.js";import{P as U}from"./plus-BhylbLjU.js";import"./app-BojVexQw.js";import"./breadcrumbs-CfH9HSk2.js";import"./createLucideIcon-AVJzoGs5.js";import"./index-CaoPq-lK.js";import"./utils-D-KgF5mV.js";import"./index-DZGh8cYj.js";import"./index-C4BIJOdj.js";import"./chevron-down-C8aG4wQu.js";import"./index-D85psPK1.js";import"./index-DL4BAlbN.js";import"./index-D-SBhKFM.js";import"./chevron-right-F_DONt-v.js";import"./index-CHBa3DK4.js";import"./index-DZfrvXPy.js";import"./chevrons-up-down-D26-hiHV.js";import"./app-logo-icon-D1TxLKab.js";import"./calendar-CQ4TJ2Ye.js";import"./package-CMie0C_N.js";import"./circle-alert-CxFuhzFA.js";import"./badge-NokOUrZG.js";import"./index-DufLrpEQ.js";import"./index-BdQq_4o_.js";import"./index-Di7OUUGl.js";import"./check-DVZ7LPyx.js";function ke({auth:E,succursales:I,produits:v}){const[o,h]=P.useState({}),{data:a,setData:u,post:w,processing:b}=V({note:"",items:[{produit_id:"",quantite:"",succursale_destination_id:""}]}),{flash:m}=B().props;m.error&&l.error(m.error),m.success&&l.success(m.success);const T=s=>{s.preventDefault();const r={};let t=!1;if(a.items.forEach((i,j)=>{const x=Number(i.produit_id),p=Number(i.quantite),n=g(x);p>n&&(r[j]=`Stock insuffisant. Disponible: ${n}`,t=!0)}),t){h(r),l("Veuillez corriger les erreurs dans le formulaire");return}w(route("transferts-central.store"),{onError:()=>{l("Une erreur est survenue lors de la création du transfert")},onSuccess:()=>{l("Transfert créé avec succès")}})},A=()=>{u("items",[...a.items,{produit_id:"",quantite:"",succursale_destination_id:""}])},D=s=>{const r=[...a.items];r.splice(s,1),u("items",r);const t={...o};delete t[s],h(t)},f=(s,r,t)=>{const i=[...a.items];if(i[s]={...i[s],[r]:t},u("items",i),r==="quantite"&&i[s].produit_id){const j=Number(i[s].produit_id),x=Number(t),p=g(j),n={...o};x>p?n[s]=`Stock insuffisant. Disponible: ${p}`:delete n[s],h(n)}},g=s=>{var t;if(!s)return 0;const r=v.find(i=>i.id===s);return((t=r==null?void 0:r.stock)==null?void 0:t.quantite)??0},L=[{title:"Dashboard",href:"/dashboard"},{title:"Stocks",href:"/stocks"},{title:"Transferts",href:"/transferts"},{title:"Nouveau transfert",href:"#"}];return e.jsxs(Q,{auth:E,breadcrumbs:L,children:[e.jsx(H,{title:"Créer un transfert"}),e.jsxs("div",{className:"flex flex-1 flex-col gap-4 p-4 md:gap-8 md:p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Nouveau transfert"}),e.jsx(N,{href:route("transferts.index"),children:e.jsx(c,{variant:"outline",children:"Retour"})})]}),e.jsxs($,{children:[e.jsx(z,{children:e.jsx(F,{children:"Informations du transfert"})}),e.jsx(R,{children:e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsx("div",{className:"grid gap-4",children:e.jsxs("div",{children:[e.jsx(d,{htmlFor:"note",children:"Note (optionnel)"}),e.jsx(S,{id:"note",value:a.note,onChange:s=>u("note",s.target.value),placeholder:"Note sur le transfert"})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(d,{children:"Articles à transférer"}),a.items.map((s,r)=>e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4 p-4 border rounded-lg relative",children:[o[r]&&e.jsx("div",{className:"absolute -top-2 -right-2 bg-destructive text-dark text-xs px-2 py-1 rounded-md",children:o[r]}),e.jsxs("div",{className:"md:col-span-5",children:[e.jsx(d,{children:"Produit"}),e.jsxs(_,{value:s.produit_id,onValueChange:t=>f(r,"produit_id",t),required:!0,children:[e.jsx(C,{children:e.jsx(k,{placeholder:"Sélectionner un produit"})}),e.jsx(q,{children:v.map(t=>{var i;return e.jsxs(y,{value:String(t.id),children:[t.name," - Stock: ",((i=t.stock)==null?void 0:i.quantite)??0]},t.id)})})]})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(d,{children:"Quantité"}),e.jsx(S,{type:"number",min:"1",value:s.quantite,onChange:t=>{const i=t.target.value;(i===""||/^[1-9]\d*$/.test(i))&&f(r,"quantite",i)},placeholder:"Quantité",required:!0})]}),e.jsxs("div",{className:"md:col-span-3",children:[e.jsx(d,{children:"Branche destination"}),e.jsxs(_,{value:s.succursale_destination_id,onValueChange:t=>f(r,"succursale_destination_id",t),required:!0,children:[e.jsx(C,{children:e.jsx(k,{placeholder:"Destination"})}),e.jsx(q,{children:I.map(t=>e.jsx(y,{value:String(t.id),children:t.nom},t.id))})]})]}),e.jsx("div",{className:"md:col-span-1 flex items-end",children:e.jsx(c,{type:"button",variant:"destructive",size:"sm",onClick:()=>D(r),disabled:a.items.length===1,children:e.jsx(O,{className:"h-4 w-4"})})})]},r)),e.jsxs(c,{type:"button",variant:"outline",className:"w-full",onClick:A,children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Ajouter un article"]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[e.jsx(N,{href:route("transferts.index"),children:e.jsx(c,{variant:"outline",type:"button",children:"Annuler"})}),e.jsx(c,{type:"submit",disabled:b||Object.keys(o).length>0,children:b?"Enregistrement...":"Enregistrer le transfert"})]})]})})]})]})]})}export{ke as default};
